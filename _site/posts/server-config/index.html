<!doctype html>
















<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" 
  
>
  <!-- The Head -->

<head>
  
    <!-- Switch the mode between dark and light. -->

<script type="text/javascript">
  class ModeToggle {
    static get MODE_KEY() {
      return 'mode';
    }
    static get MODE_ATTR() {
      return 'data-mode';
    }
    static get DARK_MODE() {
      return 'dark';
    }
    static get LIGHT_MODE() {
      return 'light';
    }
    static get ID() {
      return 'mode-toggle';
    }

    constructor() {
      if (this.hasMode) {
        if (this.isDarkMode) {
          if (!this.isSysDarkPrefer) {
            this.setDark();
          }
        } else {
          if (this.isSysDarkPrefer) {
            this.setLight();
          }
        }
      }

      let self = this;

      /* always follow the system prefers */
      this.sysDarkPrefers.addEventListener('change', () => {
        if (self.hasMode) {
          if (self.isDarkMode) {
            if (!self.isSysDarkPrefer) {
              self.setDark();
            }
          } else {
            if (self.isSysDarkPrefer) {
              self.setLight();
            }
          }

          self.clearMode();
        }

        self.notify();
      });
    } /* constructor() */

    get sysDarkPrefers() {
      return window.matchMedia('(prefers-color-scheme: dark)');
    }

    get isSysDarkPrefer() {
      return this.sysDarkPrefers.matches;
    }

    get isDarkMode() {
      return this.mode === ModeToggle.DARK_MODE;
    }

    get isLightMode() {
      return this.mode === ModeToggle.LIGHT_MODE;
    }

    get hasMode() {
      return this.mode != null;
    }

    get mode() {
      return sessionStorage.getItem(ModeToggle.MODE_KEY);
    }

    /* get the current mode on screen */
    get modeStatus() {
      if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) {
        return ModeToggle.DARK_MODE;
      } else {
        return ModeToggle.LIGHT_MODE;
      }
    }

    setDark() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE);
    }

    setLight() {
      document.documentElement.setAttribute(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE);
      sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE);
    }

    clearMode() {
      document.documentElement.removeAttribute(ModeToggle.MODE_ATTR);
      sessionStorage.removeItem(ModeToggle.MODE_KEY);
    }

    /* Notify another plugins that the theme mode has changed */
    notify() {
      window.postMessage(
        {
          direction: ModeToggle.ID,
          message: this.modeStatus
        },
        '*'
      );
    }

    flipMode() {
      if (this.hasMode) {
        if (this.isSysDarkPrefer) {
          if (this.isLightMode) {
            this.clearMode();
          } else {
            this.setLight();
          }
        } else {
          if (this.isDarkMode) {
            this.clearMode();
          } else {
            this.setDark();
          }
        }
      } else {
        if (this.isSysDarkPrefer) {
          this.setLight();
        } else {
          this.setDark();
        }
      }

      this.notify();
    } /* flipMode() */
  } /* ModeToggle */

  const modeToggle =  new ModeToggle();
</script>

  

  

  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >


  
  <meta name="keywords" content="rainsin, blog, 树莓派, 流程, ubuntu, Emby, Gitea, Apache, Docker">
  <meta name="author" content="rainsin">
  

  <script>
      window.load_event = {
      ...window.load_event,
      load_anime: ()=>{
        const loads = document.getElementById("loading-gif-box");
        loads.style.opacity = "0";
        loads.style.zIndex = "-999999";
      }
    }
  </script>

  
  <!-- MathJax -->
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'],
          ['\\(', '\\)']
        ],
        displayMath: [
          ['$$', '$$'],
          ['\\[', '\\]']
        ],
        tags: 'ams'
      }
    };
  </script>
  
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>


  <!-- <script src="/assets/js/dev.js"></script> -->
  
  <link rel="stylesheet" href="/assets/css/comments.css"/>
  <link rel="stylesheet" href="/assets/css/root.css"/>

  <link
    rel="stylesheet"
    href="https://cdn.bootcdn.net/ajax/libs/waline/3.2.6/waline.min.css"
  />

  
  <!-- <script src="https://cdn.staticfile.org/twikoo/1.6.31/twikoo.all.min.js"></script> -->

    <!-- <script>
      window.load_event= {
        ...window.load_event,
        comments: () => {
          twikoo.init({
            envId: 'https://comment.vip.cpolar.cn',
            el: '#tcomment',
            onCommentLoaded: window.load_event.comments_style
          });
        }
      }
      
  </script> -->

<script type="module">
  import { init } from 'https://cdn.jsdelivr.net/npm/@waline/client@3.3.0/dist/waline.js';
  window.load_event= {
        ...window.load_event,
        comments: () => {
          init({
              el: '#tcomment',
              serverURL: 'https://waline.rainsin.cn',
          });
        }
      }
</script>
  

  <script>
    const style = document.createElement("style");
    style.type = "text/css";

    if(modeToggle.modeStatus == "dark"){
      style.innerHTML="#loading-gif-box{background-color: #000;} .loading-boxs-imgs{background-image: url(https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/load/darkloading.gif);}"
    }else{
      style.innerHTML="#loading-gif-box{background-color: #fff;} .loading-boxs-imgs{background-image: url(https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/load6.gif);}"
    };

    document.getElementsByTagName("head")[0].appendChild(style);
  </script>

  

  

  

  

  

  

  

  

  
  
  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.3" />
<meta property="og:title" content="创建自己的影视库和各种服务" />
<meta name="author" content="Rainsin Yu" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="在树莓派上创建自己的影视库和各种服务" />
<meta property="og:description" content="在树莓派上创建自己的影视库和各种服务" />
<link rel="canonical" href="http://localhost:4000/posts/server-config/" />
<meta property="og:url" content="http://localhost:4000/posts/server-config/" />
<meta property="og:site_name" content="Rainsin • Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-06-10T11:33:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="创建自己的影视库和各种服务" />
<meta name="twitter:site" content="@2000_python" />
<meta name="twitter:creator" content="@2000_python" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Rainsin Yu","url":"https://github.com/rainsins/"},"dateModified":"2024-07-08T18:33:35+08:00","datePublished":"2023-06-10T11:33:00+08:00","description":"在树莓派上创建自己的影视库和各种服务","headline":"创建自己的影视库和各种服务","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/server-config/"},"url":"http://localhost:4000/posts/server-config/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>创建自己的影视库和各种服务 | Rainsin • Blog
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->




<link rel="apple-touch-icon" sizes="180x180" href=" https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/favicon/code/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href=" https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/favicon/code/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href=" https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/favicon/code/favicon-16x16.png">
<link rel="manifest" href=" https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/favicon/code/site.webmanifest">
<link rel="shortcut icon" href=" https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/favicon/code/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Rainsin • Blog">
<meta name="application-name" content="Rainsin • Blog">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content=" https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/favicon/code/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/style.css">

  
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/tocbot/4.21.1/tocbot.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css">
  

  <!-- 流量分析 -->
  <script charset="UTF-8" id="LA_COLLECT" src="//sdk.51.la/js-sdk-pro.min.js"></script>
  <script>LA.init({id:"3IKqlmTJRQUxCNoU",ck:"3IKqlmTJRQUxCNoU",autoTrack:true})</script>

  <!-- JavaScript -->
  <!-- <style>
    @media (prefers-color-scheme: dark){
      #loading-gif-box{
        background-color: #000;
      }

      .loading-boxs-imgs{
        background-image: url(https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/load/darkloading.gif);
      }
    }

    @media (prefers-color-scheme: light){
      #loading-gif-box{
        background-color: #fff;
      }

      .loading-boxs-imgs{
        background-image: url(https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/load6.gif);
      }
    }
  </style> -->

  <link href="/assets/css/font.css" rel="stylesheet">

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        window.load_event["load_anime"]();
      });
    </script>
    <div id="loading-gif-box" style="
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    width: 100vw;
    height: 100vh;
    z-index: 9999999999;
    ">
    <div class="loading-boxs-imgs" style="
      background-size: cover;
      background-position: center;
      width: 250px;
      aspect-ratio: 1;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
    ">
    </div>
  </div>
    
    <!-- The Side Bar -->

<div id="sidebar" class="d-flex flex-column align-items-end">
  <div class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/website/avatar.webp" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <div class="site-title">
      <a href="/">Rainsin's Blog</a>
    </div>
    <div class="site-subtitle">如人饮水，冷暖自知。</div>
  </div>
  <!-- .profile-wrapper -->

  <ul class="nav flex-column flex-grow-1 w-100 ps-0">
    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home"></i>
        <span>文章</span>
      </a>
    </li>
    <!-- the real tabs -->
    
      <li class="nav-item">
        <a href="/categories/" class="nav-link">
          <i class="fa-fw fas fa-stream"></i>
          

          <span>分类</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/links/" class="nav-link">
          <i class="fa-fw fas fa-paperclip"></i>
          

          <span>友链</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/about/" class="nav-link">
          <i class="fa-fw fas fa-infinity"></i>
          

          <span>关于</span>
        </a>
      </li>
      <!-- .nav-item -->
    
      <li class="nav-item">
        <a href="/archives/" class="nav-link">
          <i class="fa-fw fas fa-archive"></i>
          

          <span>归档</span>
        </a>
      </li>
      <!-- .nav-item -->
    
  </ul>
  <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    
      <button class="mode-toggle btn" aria-label="Switch Mode">
        <i class="fas fa-adjust"></i>
      </button>

      
        <span class="icon-border"></span>
      
    

    
      

      
        <a
          href="https://github.com/rainsins"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      

      
        <a
          href="https://twitter.com/2000_python"
          aria-label="twitter"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-twitter"></i>
        </a>
      
    
      

      
        <a
          href="javascript:location.href = 'mailto:' + ['rainsin','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      

      
        <a
          href="/feed.xml"
          aria-label="rss"
          

          

          

          
        >
          <i class="fas fa-rss"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</div>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div id="main" class="container px-xxl-5">
        <!-- The Top Bar -->

<div id="topbar-wrapper">
  <div
    id="topbar"
    class="container d-flex align-items-center justify-content-between h-100"
  >
    <span id="breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                文章
              </a>
            </span>

          
        
          
        
          
            
              <span>创建自己的影视库和各种服务</span>
            

          
        
      
    </span>
    <!-- endof #breadcrumb -->

    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>

    <div id="topbar-title">
      文章
    </div>

    <i id="search-trigger" class="fas fa-search fa-fw"></i>
    <span id="search-wrapper" class="align-items-center">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </span>
    <span id="search-cancel">取消</span>
  </div>
</div>

        













<div class="row">
  <!-- core -->
  <div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pe-xl-4">
    

    <div class="post px-1 px-md-2">
      

      
        
      
        <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->


<!-- images -->



  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  
    

    
    

    

    
    

    
    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    

    

    

    <!-- lazy-load images <https://github.com/aFarkas/lazysizes#readme> -->
    
    

    <!-- add image placeholder -->
    
      
    

    <!-- Bypass the HTML-proofer test -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        
      
    

    <!-- combine -->
    

  

  



<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    
      

      
      

      
      
      

      

    

    

  

  
  

  




<!-- return -->




<h1 data-toc-skip>创建自己的影视库和各种服务</h1>

<div class="post-meta text-muted">
    <!-- published date -->
    <span>
      发表于
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class=""
  data-ts="1686367980"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2023/06/10
</em>

    </span>

    <!-- lastmod date -->
    
    <span>
      更新于
      <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class=""
  data-ts="1720434815"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2024/07/08
</em>

    </span>
    

  

  <div class="d-flex justify-content-between">
    <!-- author(s) -->
    <span>
      

      作者

      <em>
      
        
          <a href="https://github.com/rainsins/">Rainsin Yu</a>
          
        
      
      </em>
    </span>

    <div>
      <!-- page views -->
      

      <!-- read time -->
      <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="8395 字"
>
  <em>46 分钟</em>阅读</span>

    </div>

  </div> <!-- .d-flex -->

</div> <!-- .post-meta -->

<div class="post-content">
  <h2 id="服务器相关配置"><span class="me-2">服务器相关配置</span><a href="#服务器相关配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>万一服务器有问题，按这个步骤来。带星号<code class="language-plaintext highlighter-rouge">*</code> 是舍弃的项目。</p>

<p>设置su密码：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>passwd
</pre></td></tr></tbody></table></code></div></div>

<h2 id="0-终端设置与美化"><span class="me-2">0 终端设置与美化</span><a href="#0-终端设置与美化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="01-命令行使用代理"><span class="me-2">0.1 命令行使用代理</span><a href="#01-命令行使用代理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>安装：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>proxychains4
</pre></td></tr></tbody></table></code></div></div>

<p>打开配置文件</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/proxychains4.conf
</pre></td></tr></tbody></table></code></div></div>

<p>在尾部添加代理服务器协议 + ip + port</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># socks4 127.0.0.1 9050 # 把原来的注释掉</span>
socks5 127.0.0.1 1080
</pre></td></tr></tbody></table></code></div></div>

<p>使用：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>proxychains4 &lt;命令&gt;
</pre></td></tr></tbody></table></code></div></div>

<h3 id="02-安装nushell和配置oh-my-posh"><span class="me-2">0.2 安装nushell和配置Oh-my-posh</span><a href="#02-安装nushell和配置oh-my-posh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="021-安装-rust"><span class="me-2">0.2.1 <strong>安装 Rust</strong></span><a href="#021-安装-rust" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>gcc <span class="c">#rust必需要的</span>

curl <span class="nt">--proto</span> <span class="s1">'=https'</span> <span class="nt">--tlsv1</span>.2 <span class="nt">-sSf</span> https://sh.rustup.rs | sh
</pre></td></tr></tbody></table></code></div></div>

<h4 id="022-安装依赖"><span class="me-2">0.2.2 安装依赖</span><a href="#022-安装依赖" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>pkg-config libssl-dev
<span class="nb">sudo </span>apt <span class="nb">install </span>libxcb-composite0-dev libx11-dev
</pre></td></tr></tbody></table></code></div></div>

<h4 id="023-使用-cratesio-进行构建"><span class="me-2">0.2.3 使用 <a href="https://crates.io/">crates.io</a> 进行构建</span><a href="#023-使用-cratesio-进行构建" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>cargo <span class="nb">install </span>nu
</pre></td></tr></tbody></table></code></div></div>

<p>安装完毕后，我们可以使用 <code class="language-plaintext highlighter-rouge">nu</code> 命令运行 Nu。</p>

<h4 id="024-nu安装扩展"><span class="me-2">0.2.4 nu安装扩展</span><a href="#024-nu安装扩展" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>将扩展的仓库<code class="language-plaintext highlighter-rouge">clone</code> 下来，然后构建执行文件。</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>git clone &lt;repositories.git&gt;

<span class="nb">cd</span> &lt;repositories&gt;
cargo build <span class="nt">--release</span>
register ./target/release/&lt;repositories&gt;
</pre></td></tr></tbody></table></code></div></div>

<h4 id="025-oh-my-posh"><span class="me-2">0.2.5 Oh-my-posh</span><a href="#025-oh-my-posh" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>参考 <a href="https://ohmyposh.dev/docs/installation/linux">官方文档</a> ，很详尽。</p>

<p>效果：</p>

<p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/ca7064780eb43ded.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/ca7064780eb43ded.png" alt="Snipaste_2023-03-10_00-45-07.png" class="lazyload" data-proofer-ignore></a></p>

<h2 id="1-fstab文件的配置"><span class="me-2">1 fstab文件的配置</span><a href="#1-fstab文件的配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="11-查看磁盘空间"><span class="me-2">1.1 查看磁盘空间</span><a href="#11-查看磁盘空间" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>fdisk <span class="nt">-l</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="12-查看磁盘信息"><span class="me-2">1.2 查看磁盘信息</span><a href="#12-查看磁盘信息" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>blkid
</pre></td></tr></tbody></table></code></div></div>

<h3 id="13-找到fstab文件"><span class="me-2">1.3 找到fstab文件</span><a href="#13-找到fstab文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">cd</span> /etc
</pre></td></tr></tbody></table></code></div></div>

<h3 id="14-打开fstab我习惯用nano"><span class="me-2">1.4 打开fstab，我习惯用nano</span><a href="#14-打开fstab我习惯用nano" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano fstab
</pre></td></tr></tbody></table></code></div></div>

<h3 id="15-编辑"><span class="me-2">1.5 编辑</span><a href="#15-编辑" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在尾部加入以下</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="nv">LABEL</span><span class="o">=</span>writable  /       ext4    discard,errors<span class="o">=</span>remount-ro       0 1
<span class="nv">UUID</span><span class="o">=</span><span class="s2">"3C2831055A5270C3"</span> /mdata ntfs defaults 0 1
<span class="nv">UUID</span><span class="o">=</span><span class="s2">"5CB7E03A333A1F21"</span> /movie ntfs defaults 0 1
<span class="nv">UUID</span><span class="o">=</span><span class="s2">"26BADED554B2A139"</span> /rdata ntfs defaults 0 1
<span class="nv">UUID</span><span class="o">=</span><span class="s2">"30B8B9F6B8B9BB24"</span> /avdata ntfs defaults 0 1
<span class="nv">UUID</span><span class="o">=</span><span class="s2">"451F30BC5E8250E3"</span> /home/ubuntu/pdata ntfs defaults 0 1
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">ctrl</code> + <code class="language-plaintext highlighter-rouge">x</code>保存，重启生效。</p>

<h2 id="2-samba配置"><span class="me-2">2 samba配置</span><a href="#2-samba配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="21-安装samba"><span class="me-2">2.1 安装samba</span><a href="#21-安装samba" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>要安装 Samba，我们运行：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>samba
</pre></td></tr></tbody></table></code></div></div>

<h3 id="22-设置samba"><span class="me-2">2.2 设置Samba</span><a href="#22-设置samba" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>现在安装了 Samba，我们需要创建一个目录供其共享：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">mkdir</span> &lt;pathname&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>上面的命令创建一个新文件夹 <code class="language-plaintext highlighter-rouge">sambashare</code>在我们稍后将共享的主目录中，我直接分享 <code class="language-plaintext highlighter-rouge">~</code> 目录。</p>

<p>Samba 的配置文件位于 <code class="language-plaintext highlighter-rouge">/etc/samba/smb.conf</code>. 要将新目录添加为共享，我们通过运行以下命令来编辑文件：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/samba/smb.conf
</pre></td></tr></tbody></table></code></div></div>

<p>在文件底部，添加以下行：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>[sambashare] 
		comment = &lt;title&gt;
    path = &lt;pathname&gt;
    read only = no
    browsable = yes
</pre></td></tr></tbody></table></code></div></div>

<p>然后按 <code class="language-plaintext highlighter-rouge">Ctrl-O</code>保存和 <code class="language-plaintext highlighter-rouge">Ctrl-X</code>退出文本编辑器。</p>

<p>现在我们已经配置了新共享，保存它并重新启动 Samba 使其生效：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>service smbd restart
</pre></td></tr></tbody></table></code></div></div>

<p>更新防火墙规则以允许 Samba 流量：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>ufw allow samba
</pre></td></tr></tbody></table></code></div></div>

<p>由于 Samba 不使用系统帐户密码，因此我们需要为我们的用户帐户设置一个 Samba 密码：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>smbpasswd <span class="nt">-a</span> username //username为用户名
</pre></td></tr></tbody></table></code></div></div>

<p>windows用IPv6访问：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>\\240e-335-2805-2be0-dea6-32ff-fefe-1496.ipv6-literal.net
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">:</code> 用 <code class="language-plaintext highlighter-rouge">-</code> 分隔。</p>

<h2 id="3-安装emby"><span class="me-2">3 安装Emby</span><a href="#3-安装emby" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="31-下载emby"><span class="me-2">3.1 下载Emby</span><a href="#31-下载emby" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>链接：<a href="https://github.com/MediaBrowser/Emby.Releases/releases/download/4.7.11.0/emby-server-deb_4.7.11.0_arm64.deb">Arm64架构</a>，<a href="https://github.com/MediaBrowser/Emby.Releases/releases/download/4.7.11.0/emby-server-deb_4.7.11.0_amd64.deb">X64架构</a></p>

<h3 id="32-安装"><span class="me-2">3.2 安装</span><a href="#32-安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>dpkg <span class="nt">-i</span> emby-server-deb_4.7.11.0_arm64.deb //arm64架构
dpkg <span class="nt">-i</span> emby-server-deb_4.7.11.0_amd64.deb //X64架构
</pre></td></tr></tbody></table></code></div></div>

<p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/291deb91c4a9d86e.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/291deb91c4a9d86e.png" alt="Snipaste_2023-03-09_00-38-37.png" class="lazyload" data-proofer-ignore></a>。</p>

<h2 id="4-安装docker"><span class="me-2">4 安装Docker</span><a href="#4-安装docker" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>安装docker的命令很简单</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install</span> <span class="nt">-y</span> docker.io
</pre></td></tr></tbody></table></code></div></div>

<p>安装的时间可能有一点长，请耐心等待。。。 安装完成后可能需要启动下。。</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>systemctl start docker
</pre></td></tr></tbody></table></code></div></div>

<p>设置开机就启动docker</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>systemctl <span class="nb">enable </span>docker
</pre></td></tr></tbody></table></code></div></div>

<p>查看docker是否安装成功</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker version
</pre></td></tr></tbody></table></code></div></div>

<p>注意这里只显示了Client的信息，下面有一个报错: persission denied…，这个是因为我们安装的时候是用的sudo安装，在这里是没有权限连接docker的服务端，解决办法是把当前用户加入到docker组里面去。</p>

<p>首先新建一个docker组</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>groupadd docker
</pre></td></tr></tbody></table></code></div></div>

<p>但是很可能已经有了docker组了，已有的话就不用管了，继续下一步</p>

<p>然后把当前用户加入docker组</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>gpasswd <span class="nt">-a</span> <span class="k">${</span><span class="nv">USER</span><span class="k">}</span> docker
</pre></td></tr></tbody></table></code></div></div>

<p>重启docker</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>service docker restart
</pre></td></tr></tbody></table></code></div></div>

<p>最后一步肥肠重要。。切换当前会话到新 group</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>newgrp - docker
</pre></td></tr></tbody></table></code></div></div>

<p>最后测试下效果</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker version
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre>Client:
 Version:           20.10.12
 API version:       1.41
 Go version:        go1.17.3
 Git commit:        20.10.12-0ubuntu4
 Built:             Mon Mar  7 17:11:41 2022
 OS/Arch:           linux/arm64
 Context:           default
 Experimental:      <span class="nb">true

</span>Server:
 Engine:
  Version:          20.10.12
  API version:      1.41 <span class="o">(</span>minimum version 1.12<span class="o">)</span>
  Go version:       go1.17.3
  Git commit:       20.10.12-0ubuntu4
  Built:            Mon Mar  7 15:57:50 2022
  OS/Arch:          linux/arm64
  Experimental:     <span class="nb">false
 </span>containerd:
  Version:          1.5.9-0ubuntu3.1
  GitCommit:
 runc:
  Version:          1.1.0-0ubuntu1.1
  GitCommit:
 docker-init:
  Version:          0.19.0
  GitCommit:
</pre></td></tr></tbody></table></code></div></div>

<p>最后的最后，因为国内网速问题，下载镜像比较慢所以可以使用国内大厂提供的加速器，我这里使用的是阿里云提供的加速器，使用镜像加速必须得改一下docker的配置文件 /etc/docker/daemon.json</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/docker/daemon.json
</pre></td></tr></tbody></table></code></div></div>

<p>在里面加入镜像加速器地址。。</p>

<div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">  
		</span><span class="nl">"registry-mirrors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"https://registry.docker-cn.com"</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div></div>

<p>完成。</p>

<h2 id="5-安装bitwarden"><span class="me-2">5 安装Bitwarden</span><a href="#5-安装bitwarden" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>一款密码管理器</p>

<p>开启HTTPS：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="nt">--name</span> bitwarden <span class="se">\</span>
	<span class="nt">-e</span> <span class="nv">ROCKET_TLS</span><span class="o">=</span><span class="s1">'{certs="/ssl/certs.pem",key="/ssl/key.key"}'</span> <span class="se">\</span>
  <span class="nt">-v</span> /home/ubuntu/Nginx/:/ssl/ <span class="se">\</span>
  <span class="nt">-v</span> /Bitwarden/:/data/ <span class="se">\</span>
  <span class="nt">-p</span> 443:80 <span class="se">\</span>
  vaultwarden/server:latest
</pre></td></tr></tbody></table></code></div></div>

<h2 id="6-安装alist"><span class="me-2">6 安装Alist*</span><a href="#6-安装alist" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>一款小云盘</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>docker pull xhofe/alist:latest
docker run <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-v</span> /home/ubuntu:/opt/alist/data <span class="nt">-p</span> 5244:5244 <span class="nt">-e</span> <span class="nv">UMASK</span><span class="o">=</span>022 <span class="nt">--name</span><span class="o">=</span><span class="s2">"alist"</span> xhofe/alist:latest
</pre></td></tr></tbody></table></code></div></div>

<p>查看管理员信息：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker <span class="nb">exec</span> <span class="nt">-it</span> alist ./alist admin
</pre></td></tr></tbody></table></code></div></div>

<p>可以使用另外一个项目：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>docker run <span class="nt">-d</span> <span class="se">\</span>
    <span class="nt">--name</span><span class="o">=</span>zfile <span class="se">\</span>
    <span class="nt">--restart</span><span class="o">=</span>always <span class="se">\</span>
    <span class="nt">-p</span> 3555:8080 <span class="se">\</span>
    <span class="nt">-v</span> /root/zfile/conf:/root/.zfile-v4 <span class="se">\</span>
    <span class="nt">-v</span> /home/ubuntu/pdata/zfile/file:/root/zfile/data <span class="se">\</span>
		stilleshan/zfile
</pre></td></tr></tbody></table></code></div></div>

<h2 id="7-安装ddns"><span class="me-2">7 安装DDNS</span><a href="#7-安装ddns" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="nt">--name</span> ddns-go <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">--net</span><span class="o">=</span>host <span class="nt">-v</span> /opt/ddns-go:/root jeessy/ddns-go
</pre></td></tr></tbody></table></code></div></div>

<h2 id="8-安装excalidraw"><span class="me-2">8 安装Excalidraw</span><a href="#8-安装excalidraw" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>一款画板工具</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run --rm -dit --name excalidraw -p 5000:80 jauderho/excalidraw
</pre></td></tr></tbody></table></code></div></div>

<h2 id="9-apache配置"><span class="me-2">9 Apache配置</span><a href="#9-apache配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="91-安装apache"><span class="me-2">9.1 安装Apache</span><a href="#91-安装apache" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>sudo apt-get  install  -y apache2
</pre></td></tr></tbody></table></code></div></div>

<h3 id="92-开启apache中对webdav协议的支持"><span class="me-2">9.2 开启Apache中对Webdav协议的支持</span><a href="#92-开启apache中对webdav协议的支持" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="921-开启apache中对webdav协议的支持-记住最好在用户目录下执行否则报错"><span class="me-2">9.2.1 开启Apache中对Webdav协议的支持 (记住最好在用户目录下执行否则报错)</span><a href="#921-开启apache中对webdav协议的支持-记住最好在用户目录下执行否则报错" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">cd</span> ~
<span class="nb">sudo </span>a2enmod dav
<span class="nb">sudo </span>a2enmod dav_fs
</pre></td></tr></tbody></table></code></div></div>

<h4 id="922-创建共享目录并修改权限"><span class="me-2">9.2.2 创建共享目录并修改权限</span><a href="#922-创建共享目录并修改权限" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo mkdir</span> <span class="nt">-p</span> /var/www/webdav
<span class="nb">sudo chown</span> <span class="nt">-R</span> www-data:www-data  /var/www/webdav
</pre></td></tr></tbody></table></code></div></div>

<h4 id="923-创建webdav的访问用户数据库顺便创建用户pi和guest"><span class="me-2">9.2.3 创建Webdav的访问用户数据库，顺便创建用户<code class="language-plaintext highlighter-rouge">pi</code>和<code class="language-plaintext highlighter-rouge">guest</code></span><a href="#923-创建webdav的访问用户数据库顺便创建用户pi和guest" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>htpasswd <span class="nt">-c</span> /etc/apache2/webdav.password pi
<span class="c">#sudo htpasswd /etc/apache2/webdav.password guest</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="924-修改用户数据库访问权限"><span class="me-2">9.2.4 修改用户数据库访问权限</span><a href="#924-修改用户数据库访问权限" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo chown </span>root:www-data /etc/apache2/webdav.password
<span class="nb">sudo chmod </span>640 /etc/apache2/webdav.password
</pre></td></tr></tbody></table></code></div></div>

<h4 id="925-打开默认配置文件"><span class="me-2">9.2.5 打开默认配置文件</span><a href="#925-打开默认配置文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/apache2/sites-available/000-default.conf
</pre></td></tr></tbody></table></code></div></div>

<p>全部替换为以下内容（记得先备份）：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre>Alias /webdav  /var/www/webdav

&lt;Location /webdav&gt;
 Options Indexes
 DAV On
 AuthType Basic
 AuthName <span class="s2">"webdav"</span>
 AuthUserFile /etc/apache2/webdav.password
 Require valid-user
&lt;/Location&gt;
</pre></td></tr></tbody></table></code></div></div>

<p>原文件：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre></td><td class="rouge-code"><pre>&lt;VirtualHost *:80&gt;
        # The ServerName directive sets the request scheme, hostname and port that
        # the server uses to identify itself. This is used when creating
        # redirection URLs. In the context of virtual hosts, the ServerName
        # specifies what hostname must appear in the request's Host: header to
        # match this virtual host. For the default virtual host (this file) this
        # value is not decisive as it is used as a last resort host regardless.
        # However, you must set it for any further virtual host explicitly.
        #ServerName www.example.com

        ServerAdmin webmaster@localhost
        DocumentRoot /var/www/html

        # Available loglevels: trace8, ..., trace1, debug, info, notice, warn,
        # error, crit, alert, emerg.
        # It is also possible to configure the loglevel for particular
        # modules, e.g.
        #LogLevel info ssl:warn

        ErrorLog ${APACHE_LOG_DIR}/error.log
        CustomLog ${APACHE_LOG_DIR}/access.log combined

        # For most configuration files from conf-available/, which are
        # enabled or disabled at a global level, it is possible to
        # include a line for only one particular virtual host. For example the
        # following line enables the CGI configuration for this host only
        # after it has been globally disabled with "a2disconf".
        #Include conf-available/serve-cgi-bin.conf
&lt;/VirtualHost&gt;
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo</span> /etc/init.d/apache2 force-reload
<span class="nb">sudo</span> /etc/init.d/apache2 restart
</pre></td></tr></tbody></table></code></div></div>

<h3 id="93-设置https"><span class="me-2">9.3 设置https</span><a href="#93-设置https" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p><strong>前提条件</strong></p>

<ul>
  <li>已下载Apache服务器证书。</li>
  <li>已安装Open SSL。</li>
</ul>

<p><strong>环境准备</strong></p>

<ul>
  <li>操作系统：Ubuntu</li>
  <li>Web服务器：Apache 2</li>
</ul>

<h4 id="1-执行以下命令在apache2目录下创建ssl目录"><span class="me-2">1 执行以下命令，在<code class="language-plaintext highlighter-rouge">apache2</code>目录下创建<code class="language-plaintext highlighter-rouge">ssl</code>目录。</span><a href="#1-执行以下命令在apache2目录下创建ssl目录" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">mkdir</span> /etc/apache2/cert
</pre></td></tr></tbody></table></code></div></div>

<h4 id="2-执行以下命令将下载的阿里云证书文件复制到ssl目录中"><span class="me-2">2 执行以下命令，将下载的阿里云证书文件复制到<code class="language-plaintext highlighter-rouge">ssl</code>目录中。</span><a href="#2-执行以下命令将下载的阿里云证书文件复制到ssl目录中" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nb">cp</span> <span class="nt">-r</span> YourDomainName_public.pem /etc/apache2/cert
<span class="nb">cp</span> <span class="nt">-r</span> YourDomainName_chain.pem /etc/apache2/cert
<span class="nb">cp</span> <span class="nt">-r</span> YourDomainName.key /etc/apache2/cert
</pre></td></tr></tbody></table></code></div></div>

<h4 id="3-执行以下命令启用ssl模块"><span class="me-2">3 执行以下命令，启用SSL模块</span><a href="#3-执行以下命令启用ssl模块" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>a2enmod ssl
</pre></td></tr></tbody></table></code></div></div>

<h4 id="4-执行以下命令修改ssl配置文件default-sslconf"><span class="me-2">4 执行以下命令，修改SSL配置文件default-ssl.conf</span><a href="#4-执行以下命令修改ssl配置文件default-sslconf" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>nano /etc/apache2/sites-available/default-ssl.conf
</pre></td></tr></tbody></table></code></div></div>

<p>在default-ssl.conf文件中找到以下参数，修改后保存并退出。</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="s">&lt;IfModules mod_ssl.c&gt;</span>
<span class="s">&lt;VirtualHost *:443&gt;</span>  
<span class="nn">...</span>
<span class="s">ServerName</span>   <span class="c1">#修改为证书绑定的域名。</span>
<span class="s">SSLEngine on</span>
<span class="s">SSLCertificateFile /home/ubuntu/.ssl/apache2/rainsin.cn_cert.pem</span>
<span class="s">SSLCertificateKeyFile /home/ubuntu/.ssl/apache2/rainsin.cn_key.key</span>
<span class="s">SSLCertificateChainFile /home/ubuntu/.ssl/apache2/rainsin.cn_chain.pem</span>
<span class="nn">...</span>
<span class="s">&lt;/VirtualHost&gt;</span>
<span class="s">&lt;/IfModules</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="5-执行以下命令把default-sslconf映射至etcapache2sites-enabled文件夹中建立软链接实现两者之间的自动关联"><span class="me-2">5 执行以下命令，把default-ssl.conf映射至/etc/apache2/sites-enabled文件夹中建立软链接，实现两者之间的自动关联。</span><a href="#5-执行以下命令把default-sslconf映射至etcapache2sites-enabled文件夹中建立软链接实现两者之间的自动关联" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled/001-ssl.conf
</pre></td></tr></tbody></table></code></div></div>

<h4 id="6-执行以下命令重新加载apache-2配置文件"><span class="me-2">6 执行以下命令，重新加载Apache 2配置文件。</span><a href="#6-执行以下命令重新加载apache-2配置文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo</span> /etc/init.d/apache2 force-reloadsudo /etc/init.d/apache2 restart
</pre></td></tr></tbody></table></code></div></div>

<p>完成。</p>

<h4 id="94-设置反向代理"><span class="me-2">9.4 设置反向代理</span><a href="#94-设置反向代理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>a2enmod rewrite　　　　//启用.htaccess规则，打开重写

<span class="nb">sudo </span>a2enmod proxy

<span class="nb">sudo </span>a2enmod proxy_http　　//启用反向代理
</pre></td></tr></tbody></table></code></div></div>

<p>安装好后，Apache2 HTTP 服务器关于站点的配置文件位于 <code class="language-plaintext highlighter-rouge">/etc/apache2/sites-enabled/</code> 中，我们使用熟悉的编辑器（比如 nano 或者 vim）编辑默认生成的文件：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>nano /etc/apache2/sites-enabled/000-default.conf
</pre></td></tr></tbody></table></code></div></div>

<p>在该配置文件的最底部，添加如下配置：</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="s">&lt;VirtualHost *:2000&gt;</span>
  <span class="s">ServerName &lt;二级域名&gt;.rainsin.cn</span>
  <span class="s">ServerAlias &lt;二级域名&gt;.rainsin.cn</span>
  <span class="s">SSLProxyEngine on</span>
  <span class="s">SSLEngine on</span>
  <span class="s">SSLCertificateFile /etc/apache2/cert/rainsin.cn/cert.pem</span>
  <span class="s">SSLCertificateKeyFile /etc/apache2/cert/rainsin.cn/key.key</span>
  <span class="s">SSLCertificateChainFile /etc/apache2/cert/rainsin.cn/chain.pem</span>
  
  <span class="s">ProxyPass / http://localhost:&lt;port&gt;</span>
  <span class="s">ProxyPassReverse / http://localhost:&lt;port&gt;</span>
<span class="s">&lt;/VirtualHost&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>我统一将所有的内部端口映射在2000端口上，用二级域名区分应用，在这之前需要将2000端口加入到<code class="language-plaintext highlighter-rouge">ports.conf</code>中，不然无法访问。</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Listen 2000 //你在apache中用的的端口都要在这里配置
</pre></td></tr></tbody></table></code></div></div>

<p><a href="https://www.notion.so/f4d21fd008da4c98a4e67ad89f9945ee?pvs=21">服务器相关配置</a>。</p>

<h2 id="10-安装rss服务器"><span class="me-2">10 安装rss服务器</span><a href="#10-安装rss服务器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span><span class="o">=</span>freshrss <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">TZ</span><span class="o">=</span>Asia/Shanghai <span class="se">\</span>
  <span class="nt">-p</span> 3444:80 <span class="se">\</span>
  <span class="nt">-v</span> /home/ubuntu/rss:/config <span class="se">\</span>
  <span class="nt">--restart</span> unless-stopped <span class="se">\</span>
  lscr.io/linuxserver/freshrss:latest
</pre></td></tr></tbody></table></code></div></div>

<h2 id="11-安装komga"><span class="me-2">11 安装komga</span><a href="#11-安装komga" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>一款漫画管理阅读软件</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span><span class="o">=</span>komga <span class="se">\</span>
  <span class="nt">--user</span> 1000:1000 <span class="se">\</span>
  <span class="nt">-p</span> 2666:8080 <span class="se">\</span>
  <span class="nt">-v</span> /home/ubuntu/komga/config:/config <span class="se">\</span>
  <span class="nt">-v</span> /home/ubuntu/pdata/komga:/data <span class="se">\</span>
  <span class="nt">--restart</span> unless-stopped <span class="se">\</span>
  gotson/komga
</pre></td></tr></tbody></table></code></div></div>

<h2 id="12-安装webdav"><span class="me-2">12 安装webdav</span><a href="#12-安装webdav" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>主要用来zotero的备份</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">--name</span> webdav <span class="se">\</span>
  <span class="nt">--restart</span><span class="o">=</span>unless-stopped <span class="se">\</span>
  <span class="nt">-p</span> 3478:80 <span class="se">\</span>
  <span class="nt">-v</span> &lt;webdav-path&gt;:/data <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">USERNAME</span><span class="o">=</span>&lt;webdav&gt; <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">PASSWORD</span><span class="o">=</span>&lt;webdav&gt; <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">UDI</span><span class="o">=</span>1000 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">GID</span><span class="o">=</span>1000 <span class="se">\</span>
  <span class="nt">-d</span>  derkades/webdav
</pre></td></tr></tbody></table></code></div></div>

<h2 id="13-图床安装"><span class="me-2">13 图床安装</span><a href="#13-图床安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="131-蓝空图床"><span class="me-2">13.1 蓝空图床：</span><a href="#131-蓝空图床" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>docker network create lsky-pro-net

docker run <span class="nt">-d</span> <span class="nt">-p</span> 3306:3306 <span class="nt">--name</span> mysql8.0.29 <span class="nt">--network</span> lsky-pro-net <span class="nt">--network-alias</span> mysql <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">-e</span> <span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span>123456 mysql:8.0.29

docker run <span class="nt">-d</span> <span class="nt">--name</span><span class="o">=</span>lsky-pro <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">--network</span> lsky-pro-net <span class="nt">-v</span> /home/ubuntu/pdata/lsky-pro-data:/var/www/html <span class="nt">-p</span> 7791:80 dko0/lsky-pro:2.0.4

docker <span class="nb">exec</span> <span class="nt">-it</span> mysql8.0.29 bash

mysql <span class="nt">-uroot</span> <span class="nt">-p123456</span>

create user <span class="s1">'lskypro'</span>@<span class="s1">'%'</span> identified by <span class="s1">'123456'</span><span class="p">;</span>
grant all privileges on <span class="k">*</span>.<span class="k">*</span> to <span class="s1">'lskypro'</span>@<span class="s1">'%'</span> with grant option<span class="p">;</span>
flush privileges<span class="p">;</span>
create database lskypro<span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="132-chevereto-free安装"><span class="me-2">13.2 Chevereto-free安装：</span><a href="#132-chevereto-free安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span>   <span class="nt">--name</span><span class="o">=</span>chevereto   <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000   <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000   <span class="nt">-e</span> <span class="nv">TZ</span><span class="o">=</span>Asia/Shanghai   <span class="nt">-p</span> 5080:80   <span class="nt">-p</span> 9999:443   <span class="nt">-v</span> /chevereto/config:/config   <span class="nt">-v</span> /mdata:/data   <span class="nt">--restart</span> unless-stopped   linuxserver/chevereto:latest
</pre></td></tr></tbody></table></code></div></div>

<h3 id="133-lightpicture的安装"><span class="me-2">13.3 LightPicture的安装：</span><a href="#133-lightpicture的安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>这个没有docker镜像，安装可能比较麻烦，过程中可能会有问题。</p>

<p>先决条件：</p>

<p>大环境：</p>

<ul>
  <li>apache2</li>
  <li>php (7.2~7.4)</li>
  <li>MySQL(≥5.5)</li>
</ul>

<p>PHP环境：</p>

<ul>
  <li>PDO扩展</li>
  <li>GD库</li>
  <li>fileinfo扩展</li>
  <li>curl扩展</li>
  <li>ZipArchive 支持</li>
</ul>

<p>Apache环境：</p>

<ul>
  <li>rewrite模块</li>
  <li>SSL模块</li>
</ul>

<h4 id="1331-安装php74版本"><span class="me-2">13.3.1 安装php（7.4版本）</span><a href="#1331-安装php74版本" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><strong>1. 使用apt-fast 提升下载速度的软件，安装软件时，通过增加线程使下载软件速度加快。</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>add-apt-repository ppa:apt-fast/stable
<span class="nb">sudo </span>apt-get <span class="nb">install </span>apt-fast
</pre></td></tr></tbody></table></code></div></div>

<p><strong>2. 卸载系统中已有的php版本和扩展，如果以前安装过比7.4更高或比7.2更低的版本则需要运行。</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get autoremove php<span class="k">*</span>
</pre></td></tr></tbody></table></code></div></div>

<p><strong>3. 添加php7.4的源</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>add-apt-repository ppa:ondrej/php <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get update
</pre></td></tr></tbody></table></code></div></div>

<p><strong>4. 使用apt-fast 安装php7.4</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt-fast <span class="nt">-y</span> <span class="nb">install </span>php7.4
</pre></td></tr></tbody></table></code></div></div>

<p><strong>5. 可能需要安装的扩展</strong></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt-fast <span class="nb">install </span>php7.4-fpm php7.4-mysql php7.4-curl php7.4-json php7.4-mbstring php7.4-xml php7.4-intl php7.4-gd php7.4-bcmath php7.4-zip<span class="k">*</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="1332-mysql的配置"><span class="me-2">13.3.2 MySQL的配置</span><a href="#1332-mysql的配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><strong>MySQL的安装在第17节。</strong></p>

<p>需要执行的<code class="language-plaintext highlighter-rouge">sql</code>文件在<code class="language-plaintext highlighter-rouge">public/install</code>路径下的<code class="language-plaintext highlighter-rouge">lp.sql</code>文件。</p>

<p>首先，需要创建database，可以使用MySQL管理软件创建也可以命令行进入MySQL创建，然后执行在<code class="language-plaintext highlighter-rouge">public/install</code>路径下的<code class="language-plaintext highlighter-rouge">lp.sql</code>文件。</p>

<p>我使用的是Navicat for windows，mac端好像也有，mac端也可以用Sequel Ace、MySQL Workbench、TablePlus等等。</p>

<p>也可以使用命令行：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span>
</pre></td></tr></tbody></table></code></div></div>

<p>输入密码，进入mysql：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>CREATE DATABASE &lt;name&gt;<span class="p">;</span>

use &lt;name&gt;<span class="p">;</span>

<span class="nb">source</span> /path/to/lp.sql<span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="s">systemctl restart php-fpm.service</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="1333-apache2配置"><span class="me-2">13.3.3 Apache2配置</span><a href="#1333-apache2配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>将以下配置添加进apache的任意可生效的conf文件中：</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="s">&lt;VirtualHost *:2000&gt;</span>
<span class="err">				</span><span class="c1">#你的域名，端口2000可以改</span>
        <span class="s">ServerName  &lt;url-name&gt;</span>
        <span class="s">ServerAlias &lt;title&gt;</span>

<span class="err">				</span><span class="c1">#HTTPS配置</span>
        <span class="s">SSLEngine on</span>

        <span class="s">SSLCertificateFile /home/ubuntu/.ssl/apache2/rainsin.cn_cert.pem</span>
        <span class="s">SSLCertificateKeyFile /home/ubuntu/.ssl/apache2/rainsin.cn_key.key</span>
        <span class="s">SSLCertificateChainFile /home/ubuntu/.ssl/apache2/rainsin.cn_chain.pem</span>
				
<span class="err">				</span><span class="c1">#设置为public的绝对路径</span>
        <span class="s">DocumentRoot /path/to/public</span>
<span class="err">				</span><span class="c1">#首页文件</span>
        <span class="s">DirectoryIndex index.html index.php</span>
<span class="err">				</span><span class="c1">#public文件的权限必须为可读可写，运行 chmod 755 /项目根目录/public</span>
        <span class="s">&lt;Directory "/LightPicture/public"&gt;</span>
                <span class="s">Options FollowSymLinks ExecCGI</span>
                <span class="s">AllowOverride All</span>
                <span class="s">Order allow,deny</span>
                <span class="s">Allow from all</span>
                <span class="s">Require all granted</span>
        <span class="s">&lt;/Directory&gt;</span>

        <span class="s">ErrorLog ${APACHE_LOG_DIR}/error.log</span>
        <span class="s">CustomLog ${APACHE_LOG_DIR}/access.log combined</span>
<span class="s">&lt;/VirtualHost&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>将以下文字添加进 <code class="language-plaintext highlighter-rouge">public/.htaccess</code> 中：</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="s">&lt;IfModule mod_rewrite.c&gt;</span>
  <span class="s">Options +FollowSymlinks -Multiviews</span>
  <span class="s">RewriteEngine On</span>

  <span class="s">RewriteCond %{REQUEST_FILENAME} !-d</span>
  <span class="s">RewriteCond %{REQUEST_FILENAME} !-f</span>
  <span class="s">RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]</span>
<span class="s">&lt;/IfModule&gt;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>开启rewrite模块：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo</span> <span class="k">**</span>a2enmod rewrite<span class="k">**</span>
</pre></td></tr></tbody></table></code></div></div>

<p>重启apache2：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo</span> /etc/init.d/apache2 force-reload
<span class="nb">sudo</span> /etc/init.d/apache2 restart
</pre></td></tr></tbody></table></code></div></div>

<h4 id="1334-安装完成"><span class="me-2">13.3.4 安装完成</span><a href="#1334-安装完成" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>设置<code class="language-plaintext highlighter-rouge">config/database.php</code> 文件：</p>

<div class="language-php highlighter-rouge"><div class="code-header">
        <span data-label-text="PHP"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
</pre></td><td class="rouge-code"><pre><span class="cp">&lt;?php</span>

<span class="k">return</span> <span class="p">[</span>
    <span class="c1">// 默认使用的数据库连接配置</span>
    <span class="s1">'default'</span>         <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.driver'</span><span class="p">,</span> <span class="s1">'mysql'</span><span class="p">),</span>

    <span class="c1">// 自定义时间查询规则</span>
    <span class="s1">'time_query_rule'</span> <span class="o">=&gt;</span> <span class="p">[],</span>

    <span class="c1">// 自动写入时间戳字段</span>
    <span class="c1">// true为自动识别类型 false关闭</span>
    <span class="c1">// 字符串则明确指定时间字段类型 支持 int timestamp datetime date</span>
    <span class="s1">'auto_timestamp'</span>  <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>

    <span class="c1">// 时间字段取出后的默认时间格式</span>
    <span class="s1">'datetime_format'</span> <span class="o">=&gt;</span> <span class="s1">'Y-m-d H:i:s'</span><span class="p">,</span>

    <span class="c1">// 时间字段配置 配置格式：create_time,update_time</span>
    <span class="s1">'datetime_field'</span>  <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>

    <span class="c1">// 数据库连接配置信息</span>
    <span class="s1">'connections'</span>     <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'mysql'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="c1">// 数据库类型</span>
            <span class="s1">'type'</span>            <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.type'</span><span class="p">,</span> <span class="s1">'mysql'</span><span class="p">),</span>
            <span class="c1">// 服务器地址</span>
            <span class="s1">'hostname'</span>        <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.hostname'</span><span class="p">,</span> <span class="s1">'127.0.0.1'</span><span class="p">),</span>
            <span class="c1">// 数据库名</span>
            <span class="s1">'database'</span>        <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.database'</span><span class="p">,</span> <span class="s1">'name'</span><span class="p">),</span>
            <span class="c1">// 用户名</span>
            <span class="s1">'username'</span>        <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.username'</span><span class="p">,</span> <span class="s1">'root'</span><span class="p">),</span>
            <span class="c1">// 密码</span>
            <span class="s1">'password'</span>        <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.password'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">),</span>
            <span class="c1">// 端口</span>
            <span class="s1">'hostport'</span>        <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.hostport'</span><span class="p">,</span> <span class="s1">'3306'</span><span class="p">),</span>
            <span class="c1">// 数据库连接参数</span>
            <span class="s1">'params'</span>          <span class="o">=&gt;</span> <span class="p">[],</span>
            <span class="c1">// 数据库编码默认采用utf8</span>
            <span class="s1">'charset'</span>         <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.charset'</span><span class="p">,</span> <span class="s1">'utf8'</span><span class="p">),</span>
            <span class="c1">// 数据库表前缀</span>
            <span class="s1">'prefix'</span>          <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'database.prefix'</span><span class="p">,</span> <span class="s1">'osuu_'</span><span class="p">),</span>

            <span class="c1">// 数据库部署方式:0 集中式(单一服务器),1 分布式(主从服务器)</span>
            <span class="s1">'deploy'</span>          <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
            <span class="c1">// 数据库读写是否分离 主从式有效</span>
            <span class="s1">'rw_separate'</span>     <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
            <span class="c1">// 读写分离后 主服务器数量</span>
            <span class="s1">'master_num'</span>      <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="c1">// 指定从服务器序号</span>
            <span class="s1">'slave_no'</span>        <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span>
            <span class="c1">// 是否严格检查字段是否存在</span>
            <span class="s1">'fields_strict'</span>   <span class="o">=&gt;</span> <span class="kc">true</span><span class="p">,</span>
            <span class="c1">// 是否需要断线重连</span>
            <span class="s1">'break_reconnect'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
            <span class="c1">// 监听SQL</span>
            <span class="s1">'trigger_sql'</span>     <span class="o">=&gt;</span> <span class="nf">env</span><span class="p">(</span><span class="s1">'app_debug'</span><span class="p">,</span> <span class="kc">true</span><span class="p">),</span>
            <span class="c1">// 开启字段缓存</span>
            <span class="s1">'fields_cache'</span>    <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
        <span class="p">],</span>

        <span class="c1">// 更多的数据库配置信息</span>
    <span class="p">],</span>
<span class="p">];</span>
</pre></td></tr></tbody></table></code></div></div>

<p>在浏览器中输入<code class="language-plaintext highlighter-rouge">http(s)://ip+port/install</code> 进行安装，第一步会检查环境是否配置完成，会显示未配置好的部分，根据它的提示配置好后第二步就填写MySQL的信息，最后完成。</p>

<p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/88bb1afa70d6db1c.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/88bb1afa70d6db1c.png" alt="Snipaste_2023-03-09_00-28-19.png" class="lazyload" data-proofer-ignore></a>。</p>

<h2 id="14-博客安装"><span class="me-2">14 博客安装*</span><a href="#14-博客安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>docker run <span class="se">\</span>
  <span class="nt">-it</span> <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> halo <span class="se">\</span>
  <span class="nt">-p</span> 8090:8090 <span class="se">\</span>
  <span class="nt">-v</span> &lt;path&gt;:/root/.halo2 <span class="se">\</span>
  halohub/halo:2.2.0 <span class="se">\</span>
  <span class="nt">--halo</span>.external-url<span class="o">=</span>http://localhost:8090/ <span class="se">\</span>
  <span class="nt">--halo</span>.security.initializer.superadminuser<span class="o">=</span>admin <span class="se">\</span>
  <span class="nt">--halo</span>.security.initializer.superadminpassword<span class="o">=</span>P@88w0rd
</pre></td></tr></tbody></table></code></div></div>

<h3 id="备份数据重要"><span class="me-2">备份数据（重要）</span><a href="#备份数据重要" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">cp</span> <span class="nt">-r</span> &lt;path&gt; &lt;备份path&gt;
</pre></td></tr></tbody></table></code></div></div>

<h2 id="15-minio安装"><span class="me-2">15 minio安装*</span><a href="#15-minio安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>这是一个对象存储服务。</p>

<p>首先将域名的证书文件复制到<code class="language-plaintext highlighter-rouge">&lt;config-path&gt;/certs</code>下，<code class="language-plaintext highlighter-rouge">&lt;config-path&gt;</code>这是自定义的一个路径，将在后面映射在docker容器中，证书命名为<code class="language-plaintext highlighter-rouge">private.key</code>和<code class="language-plaintext highlighter-rouge">public.crt</code>，注意<code class="language-plaintext highlighter-rouge">pem</code>可以直接重命名为<code class="language-plaintext highlighter-rouge">crt</code>。</p>

<p>然后运行：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre> docker run <span class="nt">--network</span><span class="o">=</span>host <span class="se">\</span>
    <span class="nt">-p</span> 9000:9000 <span class="nt">-p</span> 9001:9001 <span class="nt">--name</span> minio <span class="se">\</span>
    <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>always <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"MINIO_ACCESS_KEY=&lt;username&gt;"</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"MINIO_SECRET_KEY=&lt;password&gt;"</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"MINIO_SERVER_URL=https://minio.rainsin.cn:9000"</span> <span class="se">\</span>
    <span class="nt">-v</span> &lt;data-path&gt;:/data <span class="se">\</span>
    <span class="nt">-v</span> &lt;config-path&gt;:/root/.minio <span class="se">\</span>
    minio/minio server /data <span class="nt">--console-address</span> <span class="s2">"minio.rainsin.cn:9001"</span> <span class="nt">--address</span> <span class="s2">"minio.rainsin.cn:9000"</span>
</pre></td></tr></tbody></table></code></div></div>

<p>不加<code class="language-plaintext highlighter-rouge">network=host</code>（访问宿主机网络），可能<code class="language-plaintext highlighter-rouge">minio.rainsin.cn</code>这个域名无法使用。</p>

<p><code class="language-plaintext highlighter-rouge">MINIO_SERVER_URL</code>为分享链接域名。</p>

<p><del>以下弃用：</del></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">nohup sudo </span><span class="nv">MINIO_ROOT_USER</span><span class="o">=</span>admin <span class="nv">MINIO_ROOT_PASSWORD</span><span class="o">=</span>ABC871220 minio server /home/ubuntu/pdata/minio/data <span class="nt">--console-address</span> <span class="s2">":9001"</span> &amp;
</pre></td></tr></tbody></table></code></div></div>

<h2 id="16-ddns域名列表"><span class="me-2">16 ddns域名列表</span><a href="#16-ddns域名列表" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-ini highlighter-rouge"><div class="code-header">
        <span data-label-text="Ini"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="err">ddns.rainsin.cn</span>
<span class="err">hm.rainsin.cn</span>
<span class="err">emby.rainsin.cn</span>
<span class="err">rss.rainsin.cn</span>
<span class="err">mima.rainsin.cn</span>
<span class="err">pan.rainsin.cn</span>
<span class="err">photo.rainsin.cn</span>
<span class="err">draw.rainsin.cn</span>
<span class="err">webdav.rainsin.cn</span>
<span class="err">book.rainsin.cn</span>
<span class="err">bt.rainsin.cn</span>
<span class="err">sys.rainsin.cn</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="17-mysql安装"><span class="me-2">17 MySQL安装</span><a href="#17-mysql安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get <span class="nb">install </span>mysql-server
</pre></td></tr></tbody></table></code></div></div>

<p>设置root账户配置为使用密码进行身份验证，并且设置密码：</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">ALTER</span> <span class="k">USER</span> <span class="s1">'root'</span><span class="o">@</span><span class="s1">'localhost'</span> <span class="n">IDENTIFIED</span> <span class="k">WITH</span> <span class="n">mysql_native_password</span> <span class="k">BY</span> <span class="s1">'mypassword'</span><span class="p">;</span>

<span class="n">FLUSH</span> <span class="k">PRIVILEGES</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">'localhost'</code> 可以改为<code class="language-plaintext highlighter-rouge">'%'</code> ，<code class="language-plaintext highlighter-rouge">mypassword</code> 是你的密码。</p>

<p>然后输入：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>mysql_secure_installation
</pre></td></tr></tbody></table></code></div></div>

<p>输入上面设置的密码，之后全部<code class="language-plaintext highlighter-rouge">n</code>。</p>

<p>设置外网访问：</p>

<div class="language-sql highlighter-rouge"><div class="code-header">
        <span data-label-text="Sql"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="n">mysql</span> <span class="o">-</span><span class="n">u</span> <span class="n">root</span> <span class="o">-</span><span class="n">p</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="n">use</span> <span class="n">mysql</span><span class="p">;</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="k">update</span> <span class="k">user</span> <span class="k">set</span> <span class="k">host</span> <span class="o">=</span> <span class="s1">'%'</span> <span class="k">where</span> <span class="k">user</span> <span class="o">=</span><span class="err">’</span><span class="n">root</span><span class="err">’</span><span class="p">;</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="n">flush</span> <span class="k">privileges</span><span class="p">;</span>

<span class="n">mysql</span><span class="o">&gt;</span><span class="k">select</span> <span class="k">host</span><span class="p">,</span><span class="k">user</span> <span class="k">from</span> <span class="k">user</span> <span class="k">where</span> <span class="k">user</span><span class="o">=</span><span class="s1">'root'</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div></div>

<p>使用sql文件初始化数据库:</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>mysql -u root -p dbname&lt;filename.sql
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>注意：dbname是自定义的数据库名，且必须先创建好。</p>

</blockquote>

<h2 id="18-图书管理系统"><span class="me-2">18 图书管理系统*</span><a href="#18-图书管理系统" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="nt">--restart</span><span class="o">=</span>always <span class="nt">--name</span> calibresrv_web <span class="nt">-p</span> 8083:8083 <span class="nt">-v</span> /mdata/book/config:/config <span class="nt">-v</span> /mdata/book/Library:/books <span class="nt">-v</span> /mdata/book/Books_Calibre:/Books_Calibre <span class="nt">-v</span> /mdata/book/Books_Calibre_Backup:/Books_Calibre_Backup <span class="se">\-</span>v /mdata/book/Backup_Library:/Backup_Library  <span class="nt">-e</span> <span class="nv">NOTIFICATIONS</span><span class="o">=</span>enabled <span class="nt">-e</span> <span class="nv">TOKEN</span><span class="o">=</span><span class="s2">"xxxxxxxxxxxxxxxxxxxxxxxxx"</span> <span class="nt">-e</span> <span class="nv">CHATID</span><span class="o">=</span><span class="s2">"xxxxxxxxx"</span>  <span class="nt">-d</span> mephistoxol/calibresrv_web
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="nt">--name</span><span class="o">=</span>calibre <span class="nt">--security-opt</span> <span class="nv">seccomp</span><span class="o">=</span>unconfined <span class="sb">`</span><span class="c">#optional` -e PUID=1000 -e PGID=1000 -e TZ=Asia/Shanghai -e PASSWORD= `#optional` -e CLI_ARGS= `#optional` -p 8082:8080 -p 8081:8081 -v /path/to/data:/config --restart unless-stopped linuxserver/calibre:latest</span>
</pre></td></tr></tbody></table></code></div></div>

<h2 id="19-bt下载管理器"><span class="me-2">19 Bt下载管理器*</span><a href="#19-bt下载管理器" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="191-transmission和qbittorrent的安装及配置"><span class="me-2">19.1 transmission和qBittorrent的安装及配置</span><a href="#191-transmission和qbittorrent的安装及配置" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>下载种子和做种工具。</p>

<p>qBittorrent的默认用户名/密码：<code class="language-plaintext highlighter-rouge">admin/adminadmin</code> 。</p>

<p><del>舍弃：</del></p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre>docker create <span class="nt">--name</span><span class="o">=</span>qbittorrent  <span class="nt">-e</span> <span class="nv">WEBUIPORT</span><span class="o">=</span>8080 <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1026 <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>100 <span class="nt">-e</span> <span class="nv">TZ</span><span class="o">=</span>Asia/Shanghai <span class="nt">-p</span> 6881:6881 <span class="nt">-p</span> 6881:6881/udp <span class="nt">-p</span> 8087:8080 <span class="nt">-v</span> /mdata/bt/config:/config  <span class="nt">-v</span> /mdata/bt/download:/downloads <span class="nt">--restart</span> unless-stopped superng6/qbittorrent:latest

docker start qbittorrent
</pre></td></tr></tbody></table></code></div></div>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">-d</span> <span class="nt">--name</span><span class="o">=</span>transmission <span class="nt">-e</span> <span class="nv">PUID</span><span class="o">=</span>1000 <span class="nt">-e</span> <span class="nv">PGID</span><span class="o">=</span>1000 <span class="nt">-e</span> <span class="nv">TZ</span><span class="o">=</span>Asia/Shanghai <span class="nt">-e</span> <span class="nv">TRANSMISSION_WEB_HOME</span><span class="o">=</span>/transmission-web-control/src <span class="nt">-e</span> <span class="nv">USER</span><span class="o">=</span>&lt;user&gt; <span class="nt">-e</span> <span class="nv">PASS</span><span class="o">=</span>&lt;pass&gt; <span class="nt">-e</span> <span class="nv">WHITELIST</span><span class="o">=</span><span class="k">*</span> <span class="nt">-e</span> <span class="nv">PEERPORT</span><span class="o">=</span>51413 <span class="nt">-e</span> <span class="nv">HOST_WHITELIST</span><span class="o">=</span><span class="k">*</span> <span class="nt">-p</span> 9091:9091 <span class="nt">-p</span> 51413:51413 <span class="nt">-p</span> 51413:51413/udp <span class="nt">-v</span> /mdata/config:/config <span class="nt">-v</span> /mdata/bt/downloads:/downloads <span class="nt">-v</span> /mdata/bt/watch/folder:/watch <span class="nt">-v</span> /home/ubuntu/transmission-web-control:/transmission-web-control <span class="nt">--restart</span> unless-stopped linuxserver/transmission:latest
</pre></td></tr></tbody></table></code></div></div>

<h4 id="1911-下载transmission-web-control"><span class="me-2">19.1.1 <strong>下载 transmission-web-control</strong></span><a href="#1911-下载transmission-web-control" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>GitHub地址：<a href="https://github.com/ronggang/transmission-web-control">https://github.com/ronggang/transmission-web-control</a></p>

<p>Gitee 地址： <a href="https://gitee.com/culturist/transmission-web-control">https://gitee.com/culturist/transmission-web-control</a></p>

<p>国内推荐在 Gitee 下载。</p>

<p>解压文件到本地目录。</p>

<h4 id="1912-配置邮箱通知"><span class="me-2">19.1.2 配置邮箱通知</span><a href="#1912-配置邮箱通知" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p>安装bsd-mailx</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>apt-fast <span class="nb">install </span>bsd-mailx
    
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>配置<code class="language-plaintext highlighter-rouge">s-nail</code></p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>nano /etc/s-nail.rc
</pre></td></tr></tbody></table></code></div>    </div>

    <p>配置邮箱SMTP服务：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre> <span class="nb">set </span><span class="nv">from</span><span class="o">=</span><span class="s2">"xxxxxxxx@qq.com"</span>   <span class="c">#用来发送邮件的邮箱</span>
 <span class="nb">set </span><span class="nv">smtp</span><span class="o">=</span><span class="s2">"smtps://smtp.qq.com:465"</span> <span class="c">#你所选邮箱的SMTP服务器</span>
 <span class="nb">set </span>smtp-auth-user<span class="o">=</span><span class="s2">"xxxxxxxx@qq.com"</span> 
 <span class="nb">set </span>smtp-auth-password<span class="o">=</span><span class="s2">"XXXXXXXXXXXX"</span>  <span class="c">#邮箱授权码</span>
 <span class="nb">set </span>smtp-auth<span class="o">=</span>login
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>测试</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">echo</span> <span class="s2">"小可爱！"</span> | s-nail <span class="nt">-s</span> <span class="s2">"这是个测试邮件！"</span> xxxxxxxx@qq.com 
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>Tg通知准备</p>

    <p><a href="https://t.me/BotFather">https://t.me/BotFather</a>，打开与它的聊天界面，不论是 Windows mac 还是 Android iOS 的 telegram 客户端。</p>

    <ol>
      <li>
        <p>创建 bot 以及获取 token</p>

        <p>输入 <code class="language-plaintext highlighter-rouge">/newbot</code>后回车，它会回复以下内容：</p>

        <blockquote>
          <p>Alright, a new bot. How are we going to call it? Please choose a name for your bot.</p>

        </blockquote>
      </li>
      <li>这个名字是显示名称 （display name）,不是唯一识别码，现在随便设置一下，之后可以通过 <code class="language-plaintext highlighter-rouge">/setname</code>修改，比如设置成<code class="language-plaintext highlighter-rouge">Zhang san's sweety bot</code> 。</li>
      <li>
        <p>接着会让你设置唯一名称。字符串必须 endsWith <code class="language-plaintext highlighter-rouge">bot</code>，比如 <code class="language-plaintext highlighter-rouge">abc_bot</code>或 <code class="language-plaintext highlighter-rouge">Hellobot</code>都是合法的。如果你设置的名字已经被占用需要重新设置。比如你设置成了 <code class="language-plaintext highlighter-rouge">test_bot</code> 。</p>

        <blockquote>
          <p>Good. Now let’s choose a username for your bot. It must end in <code class="language-plaintext highlighter-rouge">bot</code>
 . Like this, for example: TetrisBot or tetris_bot.</p>

        </blockquote>
      </li>
      <li>
        <p>恭喜！设置成功。会返回给你重要的 API token，务必要保存好它。另外你的 bot 的唯一 url 就已经生成: <code class="language-plaintext highlighter-rouge">[https://t.me/test_bot](https://t.me/test_bot)</code> 。</p>

        <blockquote>
          <p>Done! Congratulations on your new bot. You will find it at 
 t.me/test_bot. You can now add a description, about section and profile 
 picture for your bot, see /help for a list of commands. By the way, when
  you’ve finished creating your cool bot, ping our Bot Support if you 
 want a better username for it. Just make sure the bot is fully 
 operational before you do this.</p>

          <p>Use this token to access the HTTP API:
<strong>12345678:sdfsfadsfasdfasdfasdfgdfhdfghfgh</strong>
Keep your token secure and store it safely, it can be used by anyone to control your bot.</p>

          <p>For a description of the Bot API, see this page: <a href="https://core.telegram.org/bots/api">https://core.telegram.org/bots/api</a></p>

        </blockquote>

        <p>红色的字符就是<code class="language-plaintext highlighter-rouge">BOT API</code>的TOKEN。</p>
      </li>
      <li>一些其他必要的命令：
        <ul>
          <li><code class="language-plaintext highlighter-rouge">/setdescription</code> 帮助你设置 bot 的描述</li>
          <li><code class="language-plaintext highlighter-rouge">/setuserpic</code> 设置 bot 的头像。上传的图片 size 需要大于等于 150x150。而且上传图片需要选择压缩，不能上传文件！</li>
        </ul>
      </li>
      <li>
        <p>获取chat_id</p>

        <p>使用的url：<code class="language-plaintext highlighter-rouge">https://api.telegram.org/bot{token}/getUpdates</code></p>

        <p>使用第4步获得的 <code class="language-plaintext highlighter-rouge">token</code>替换上述 url 中的 <code class="language-plaintext highlighter-rouge">{token}</code>然后得到新的 url，复制粘贴到浏览器地址栏，回车请求。不出意外你会得到如下 response</p>

        <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre> <span class="pi">{</span>
     <span class="s2">"</span><span class="s">ok"</span><span class="pi">:</span> <span class="nv">true</span><span class="pi">,</span>
     <span class="s2">"</span><span class="s">result"</span><span class="pi">:</span> <span class="pi">[]</span>
 <span class="pi">}</span>
</pre></td></tr></tbody></table></code></div>        </div>

        <p>很好。这时你打开你的 bot，随便和它说一句话，比如给它发一句 “Hello World”，或者将机器人添加进一个自建的群组或者频道，然后重新请求一遍上述的 url（替换过 token 的），不出意外你收到的 response 是这样了</p>

        <div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="p">{</span><span class="nl">"ok"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"result"</span><span class="p">:[{</span><span class="nl">"update_id"</span><span class="p">:</span><span class="mi">248345768</span><span class="p">,</span><span class="w">
 </span><span class="nl">"my_chat_member"</span><span class="p">:{</span><span class="nl">"chat"</span><span class="p">:{</span><span class="err">**</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">-1001779449685</span><span class="err">**</span><span class="p">,</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"BT</span><span class="se">\u</span><span class="s2">72b6</span><span class="se">\u</span><span class="s2">6001</span><span class="se">\u</span><span class="s2">673a"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"supergroup"</span><span class="p">},</span><span class="nl">"from"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1270423426</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span><span class="nl">"last_name"</span><span class="p">:</span><span class="s2">"Wang"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Rainsins"</span><span class="p">},</span><span class="nl">"date"</span><span class="p">:</span><span class="mi">1678610811</span><span class="p">,</span><span class="nl">"old_chat_member"</span><span class="p">:{</span><span class="nl">"user"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">6213936314</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"chatGPT"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"rainsinchat_bot"</span><span class="p">},</span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"left"</span><span class="p">},</span><span class="nl">"new_chat_member"</span><span class="p">:{</span><span class="nl">"user"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">6213936314</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"chatGPT"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"rainsinchat_bot"</span><span class="p">},</span><span class="nl">"status"</span><span class="p">:</span><span class="s2">"member"</span><span class="p">}}},{</span><span class="nl">"update_id"</span><span class="p">:</span><span class="mi">248345769</span><span class="p">,</span><span class="w">
 </span><span class="nl">"message"</span><span class="p">:{</span><span class="nl">"message_id"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="nl">"from"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1270423426</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span><span class="nl">"last_name"</span><span class="p">:</span><span class="s2">"Wang"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Rainsins"</span><span class="p">},</span><span class="nl">"chat"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">-929935885</span><span class="p">,</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"BT</span><span class="se">\u</span><span class="s2">72b6</span><span class="se">\u</span><span class="s2">6001</span><span class="se">\u</span><span class="s2">673a"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"group"</span><span class="p">,</span><span class="nl">"all_members_are_administrators"</span><span class="p">:</span><span class="kc">false</span><span class="p">},</span><span class="nl">"date"</span><span class="p">:</span><span class="mi">1678610811</span><span class="p">,</span><span class="nl">"migrate_to_chat_id"</span><span class="p">:</span><span class="mi">-1001779449685</span><span class="p">}},{</span><span class="nl">"update_id"</span><span class="p">:</span><span class="mi">248345770</span><span class="p">,</span><span class="w">
 </span><span class="nl">"message"</span><span class="p">:{</span><span class="nl">"message_id"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nl">"from"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1087968824</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Group"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"GroupAnonymousBot"</span><span class="p">},</span><span class="nl">"sender_chat"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">-1001779449685</span><span class="p">,</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"BT</span><span class="se">\u</span><span class="s2">72b6</span><span class="se">\u</span><span class="s2">6001</span><span class="se">\u</span><span class="s2">673a"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"supergroup"</span><span class="p">},</span><span class="nl">"chat"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">-1001779449685</span><span class="p">,</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"BT</span><span class="se">\u</span><span class="s2">72b6</span><span class="se">\u</span><span class="s2">6001</span><span class="se">\u</span><span class="s2">673a"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"supergroup"</span><span class="p">},</span><span class="nl">"date"</span><span class="p">:</span><span class="mi">1678610811</span><span class="p">,</span><span class="nl">"migrate_from_chat_id"</span><span class="p">:</span><span class="mi">-929935885</span><span class="p">}},{</span><span class="nl">"update_id"</span><span class="p">:</span><span class="mi">248345771</span><span class="p">,</span><span class="w">
 </span><span class="nl">"message"</span><span class="p">:{</span><span class="nl">"message_id"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="nl">"from"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1270423426</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span><span class="nl">"last_name"</span><span class="p">:</span><span class="s2">"Wang"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Rainsins"</span><span class="p">},</span><span class="nl">"chat"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">-1001779449685</span><span class="p">,</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"BT</span><span class="se">\u</span><span class="s2">72b6</span><span class="se">\u</span><span class="s2">6001</span><span class="se">\u</span><span class="s2">673a"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"supergroup"</span><span class="p">},</span><span class="nl">"date"</span><span class="p">:</span><span class="mi">1678610813</span><span class="p">,</span><span class="nl">"new_chat_participant"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">5042722248</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"</span><span class="se">\u</span><span class="s2">5c0fC-</span><span class="se">\u</span><span class="s2">5de5</span><span class="se">\u</span><span class="s2">5177</span><span class="se">\u</span><span class="s2">4eba"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"CAOYYDS_BOT"</span><span class="p">},</span><span class="nl">"new_chat_member"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">5042722248</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"</span><span class="se">\u</span><span class="s2">5c0fC-</span><span class="se">\u</span><span class="s2">5de5</span><span class="se">\u</span><span class="s2">5177</span><span class="se">\u</span><span class="s2">4eba"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"CAOYYDS_BOT"</span><span class="p">},</span><span class="nl">"new_chat_members"</span><span class="p">:[{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">5042722248</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"</span><span class="se">\u</span><span class="s2">5c0fC-</span><span class="se">\u</span><span class="s2">5de5</span><span class="se">\u</span><span class="s2">5177</span><span class="se">\u</span><span class="s2">4eba"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"CAOYYDS_BOT"</span><span class="p">}]}},{</span><span class="nl">"update_id"</span><span class="p">:</span><span class="mi">248345772</span><span class="p">,</span><span class="w">
 </span><span class="nl">"message"</span><span class="p">:{</span><span class="nl">"message_id"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="nl">"from"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1270423426</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span><span class="nl">"last_name"</span><span class="p">:</span><span class="s2">"Wang"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Rainsins"</span><span class="p">},</span><span class="nl">"chat"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">-1001779449685</span><span class="p">,</span><span class="nl">"title"</span><span class="p">:</span><span class="s2">"BT</span><span class="se">\u</span><span class="s2">72b6</span><span class="se">\u</span><span class="s2">6001</span><span class="se">\u</span><span class="s2">673a"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"supergroup"</span><span class="p">},</span><span class="nl">"date"</span><span class="p">:</span><span class="mi">1678610831</span><span class="p">,</span><span class="nl">"new_chat_participant"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1745206100</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"</span><span class="se">\u</span><span class="s2">6d88</span><span class="se">\u</span><span class="s2">606f</span><span class="se">\u</span><span class="s2">4e91</span><span class="se">\u</span><span class="s2">2601</span><span class="se">\u</span><span class="s2">fe0f"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"MsgWikiBot"</span><span class="p">},</span><span class="nl">"new_chat_member"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1745206100</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"</span><span class="se">\u</span><span class="s2">6d88</span><span class="se">\u</span><span class="s2">606f</span><span class="se">\u</span><span class="s2">4e91</span><span class="se">\u</span><span class="s2">2601</span><span class="se">\u</span><span class="s2">fe0f"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"MsgWikiBot"</span><span class="p">},</span><span class="nl">"new_chat_members"</span><span class="p">:[{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1745206100</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"</span><span class="se">\u</span><span class="s2">6d88</span><span class="se">\u</span><span class="s2">606f</span><span class="se">\u</span><span class="s2">4e91</span><span class="se">\u</span><span class="s2">2601</span><span class="se">\u</span><span class="s2">fe0f"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"MsgWikiBot"</span><span class="p">}]}},{</span><span class="nl">"update_id"</span><span class="p">:</span><span class="mi">248345773</span><span class="p">,</span><span class="w">
 </span><span class="nl">"message"</span><span class="p">:{</span><span class="nl">"message_id"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="nl">"from"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1270423426</span><span class="p">,</span><span class="nl">"is_bot"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span><span class="nl">"last_name"</span><span class="p">:</span><span class="s2">"Wang"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Rainsins"</span><span class="p">,</span><span class="nl">"language_code"</span><span class="p">:</span><span class="s2">"zh-hans"</span><span class="p">},</span><span class="nl">"chat"</span><span class="p">:{</span><span class="nl">"id"</span><span class="p">:</span><span class="mi">1270423426</span><span class="p">,</span><span class="nl">"first_name"</span><span class="p">:</span><span class="s2">"Bill"</span><span class="p">,</span><span class="nl">"last_name"</span><span class="p">:</span><span class="s2">"Wang"</span><span class="p">,</span><span class="nl">"username"</span><span class="p">:</span><span class="s2">"Rainsins"</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"private"</span><span class="p">},</span><span class="nl">"date"</span><span class="p">:</span><span class="mi">1678614094</span><span class="p">,</span><span class="nl">"text"</span><span class="p">:</span><span class="s2">"/start"</span><span class="p">,</span><span class="nl">"entities"</span><span class="p">:[{</span><span class="nl">"offset"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="nl">"length"</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="nl">"type"</span><span class="p">:</span><span class="s2">"bot_command"</span><span class="p">}]}}]}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>        </div>

        <p>如果有json美化插件，可能会好找一些，如果浏览器没有安装一些 json 美化插件，那么复制它们到任何一个在线 json 解析格式化网站，比如<a href="https://www.sojson.com/">https://www.sojson.com/</a>选择对应的格式化功能格式化文本。</p>

        <div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"ok"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
   </span><span class="nl">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
     </span><span class="p">{</span><span class="w">
       </span><span class="nl">"update_id"</span><span class="p">:</span><span class="w"> </span><span class="mi">248345768</span><span class="p">,</span><span class="w">
       </span><span class="nl">"my_chat_member"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
         </span><span class="nl">"chat"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
           </span><span class="err">**</span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">-1001779449685</span><span class="p">,</span><span class="err">**</span><span class="w">
           </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BT状态机"</span><span class="p">,</span><span class="w">
           </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"supergroup"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="err">......</span><span class="w">
       </span><span class="p">}</span><span class="w">
     </span><span class="p">},</span><span class="w">
     </span><span class="err">.....</span><span class="w">
   </span><span class="p">]</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>        </div>

        <p>知道了 token 和 chatId 就可以使用 bot 了。</p>

        <p><strong>curl 测试</strong></p>

        <div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="err">curl</span><span class="w"> </span><span class="err">-s</span><span class="w"> </span><span class="err">-X</span><span class="w"> </span><span class="err">POST</span><span class="w"> </span><span class="err">https://api.telegram.org/bot</span><span class="p">{</span><span class="err">token</span><span class="p">}</span><span class="err">/sendMessage</span><span class="w"> </span><span class="err">-d</span><span class="w"> </span><span class="err">chat_id=</span><span class="p">{</span><span class="err">chatId</span><span class="p">}</span><span class="w"> </span><span class="err">-d</span><span class="w"> </span><span class="err">text=</span><span class="s2">"Hello World"</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>        </div>
      </li>
    </ol>
  </li>
  <li>
    <p>配置通知脚本</p>

    <p>transmission和qbittorrent的参数不同需要分别配置。可以将它们的脚本分别放在两个文件夹。</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre> <span class="nb">cd</span> /var
 <span class="nb">sudo mkdir </span>tm qb
 <span class="nb">cd </span>tm <span class="o">&amp;&amp;</span> <span class="nb">sudo touch </span>btmail.sh btadd.sh btseed.sh 
 <span class="nb">cd</span> ../
 <span class="nb">cd </span>qb <span class="o">&amp;&amp;</span> <span class="nb">sudo touch </span>btmail.sh btadd.sh
 <span class="nb">sudo chmod</span> +xr  /var/tm/<span class="k">*</span>.sh /var/qb/<span class="k">*</span>.sh
</pre></td></tr></tbody></table></code></div>    </div>

    <p>然后分别编辑，可以自己写一些功能，比如通知tg、通知邮件、磁力管理（需要bash的一些知识）。</p>

    <p><code class="language-plaintext highlighter-rouge">btmail.sh</code> 为磁力下载完成时运行，<code class="language-plaintext highlighter-rouge">btadd.sh</code>为添加磁力成功后运行，<code class="language-plaintext highlighter-rouge">btseed.sh</code>为磁力任务完成后运行。</p>

    <p>transmission变量规则：</p>

    <ul>
      <li><code class="language-plaintext highlighter-rouge">TR_APP_VERSION</code> - Transmission的版本, e.g. <code class="language-plaintext highlighter-rouge">4.0.0</code></li>
      <li><code class="language-plaintext highlighter-rouge">TR_TIME_LOCALTIME</code></li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_BYTES_DOWNLOADED</code> - 磁力下载字节数</li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_DIR</code> - 磁力下载位置</li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_HASH</code> - 磁力哈希</li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_ID</code></li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_LABELS</code> - 磁力标签</li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_NAME</code> - 磁力名字 (不是文件名)</li>
      <li><code class="language-plaintext highlighter-rouge">TR_TORRENT_TRACKERS</code> - 磁力trcaker列表</li>
    </ul>

    <p>transmission可以添加以下内容，可以自由更改：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre> <span class="c">#!/bin/sh</span>
    
 <span class="nv">NAIL</span><span class="o">=</span>/usr/bin/s-nail
 <span class="nv">PROXY</span><span class="o">=</span>/usr/bin/proxychains4 <span class="c">#代理命令，telegram需要。</span>
    
 <span class="nv">totalsize</span><span class="o">=</span><span class="k">${</span><span class="nv">TR_TORRENT_BYTES_DOWNLOADED</span><span class="k">}</span>
    
 <span class="c">#格式化容量，将B转换为MB，GB等单位</span>
 <span class="nv">totalsize</span><span class="o">=</span><span class="k">${</span><span class="nv">torrent_size</span><span class="k">}</span>
 <span class="k">if</span> <span class="o">[</span> 1024 <span class="nt">-gt</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then </span><span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$totalsize</span><span class="s2">"</span>B
 <span class="k">elif</span> <span class="o">[</span> 1048576 <span class="nt">-gt</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then
        </span><span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span>  <span class="s2">"scale=3; a = </span><span class="nv">$totalsize</span><span class="s2"> / 1024 ; if (length(a)==scale(a)) print 0;print a"</span>  | bc <span class="sb">`</span>
 	<span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$size</span><span class="s2">"</span>KB
 <span class="k">elif</span> <span class="o">[</span> 1073741824 <span class="nt">-gt</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then
        </span><span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span>  <span class="s2">"scale=3; a = </span><span class="nv">$totalsize</span><span class="s2"> / 1048576 ; if (length(a)==scale(a)) print 0;print a"</span>  | bc <span class="sb">`</span>
 	<span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$size</span><span class="s2">"</span>MB
 <span class="k">elif</span> <span class="o">[</span> 1073741824 <span class="nt">-le</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then
        </span><span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span>  <span class="s2">"scale=3; a = </span><span class="nv">$totalsize</span><span class="s2"> / 1073741824 ; if (length(a)==scale(a)) print 0;print a"</span>  | bc <span class="sb">`</span>
 	<span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$size</span><span class="s2">"</span>GB
 <span class="k">else
        </span><span class="nv">size</span><span class="o">=</span><span class="s2">"0"</span>
         <span class="k">fi</span>
    
 <span class="c">#telegram通知</span>
    
 <span class="nv">TMPFILETG</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-t</span> qbittorent.XXXXXXXXXX<span class="si">)</span>
 <span class="c">#bot的TOKEN，和chat_id，获取方法参见上条。</span>
 <span class="nv">TOKEN</span><span class="o">=</span><span class="k">********</span>:<span class="k">**************************</span>
 <span class="nv">chat_ID</span><span class="o">=</span>-<span class="k">***************</span>
    
 <span class="c">#信息内容</span>
 <span class="nb">cat</span> <span class="o">&gt;</span> <span class="nv">$TMPFILETG</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
 *亲，transmission有个磁力🧲下载完成了，赶紧去看看!*
 ---
 客户端：transmission-</span><span class="k">${</span><span class="nv">TR_APP_VERSION</span><span class="k">}</span><span class="sh">，
 磁力名称：</span><span class="k">${</span><span class="nv">TR_TORRENT_NAME</span><span class="k">}</span><span class="sh">，
 磁力大小：</span><span class="k">${</span><span class="nv">size</span><span class="k">}</span><span class="sh">，
 保存地址：</span><span class="k">${</span><span class="nv">TR_TORRENT_DIR</span><span class="k">}</span><span class="sh">，
 磁力链接：*magnet:?xt=urn:btih:</span><span class="k">${</span><span class="nv">TR_TORRENT_HASH</span><span class="k">}</span><span class="sh">*，
 添加时间：</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="sh">，
 发扬互联网精神，抵制迅雷吸血💩。
 发扬互联网精神,让每一个种子都生根发芽❀。
</span><span class="no"> EOF
    
</span> <span class="c">#读取内容</span>
 <span class="nv">DATA</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> <span class="nv">$TMPFILETG</span><span class="sb">`</span>
    
 <span class="nv">MODE</span><span class="o">=</span><span class="s1">'Markdown'</span>
 <span class="nv">URL</span><span class="o">=</span><span class="s2">"https://api.telegram.org/bot</span><span class="k">${</span><span class="nv">TOKEN</span><span class="k">}</span><span class="s2">/sendMessage"</span>
    
 <span class="c">#还可以发送视频，图片等，具体可以参考tg bot api官网</span>
    
 <span class="nv">$PROXY</span> curl <span class="nt">-s</span> <span class="nt">-o</span> /dev/null <span class="nt">-X</span> POST <span class="nv">$URL</span> <span class="nt">-d</span> <span class="nv">chat_id</span><span class="o">=</span><span class="k">${</span><span class="nv">chat_ID</span><span class="k">}</span> <span class="nt">-d</span> <span class="nv">parse_mode</span><span class="o">=</span><span class="k">${</span><span class="nv">MODE</span><span class="k">}</span> <span class="nt">-d</span> <span class="nv">text</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">DATA</span><span class="k">}</span><span class="s2">"</span>
    
 <span class="c">#邮件通知</span>
    
 <span class="c">#要发送的邮件</span>
 <span class="nv">TO_ADDR1</span><span class="o">=</span><span class="s2">"**********@gmail.com"</span>
 <span class="nv">TO_ADDR2</span><span class="o">=</span><span class="s2">"***********@qq.com"</span>
 <span class="c">#TO_ADDR2="***********@163.com"</span>
    
 <span class="c">#邮件主题</span>
 <span class="nv">SUBJECT</span><span class="o">=</span><span class="s2">"亲，transmission有个磁力🧲下载完成了，赶紧去看看!"</span>
    
 <span class="c">#发送邮件</span>
 <span class="nv">$NAIL</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$SUBJECT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$TO_ADDR1</span><span class="s2">"</span> &lt; <span class="s2">"</span><span class="nv">$TMPFILETG</span><span class="s2">"</span>
 <span class="nv">$NAIL</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$SUBJECT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$TO_ADDR2</span><span class="s2">"</span> &lt; <span class="s2">"</span><span class="nv">$TMPFILETG</span><span class="s2">"</span>
    
 <span class="c">#删除临时文件</span>
 <span class="nb">rm</span> <span class="s2">"</span><span class="nv">$TMPFILETG</span><span class="s2">"</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>qbittorrent变量规则：</p>

    <ul>
      <li>%N：Torrent 名称</li>
      <li>%L：分类</li>
      <li>%G：标签（以逗号分隔）</li>
      <li>%F：内容路径（与多文件 torrent 的根目录相同）</li>
      <li>%R：根目录（第一个 torrent 的子目录路径）</li>
      <li>%D：保存路径</li>
      <li>%C：文件数</li>
      <li>%Z：Torrent 大小（字节）</li>
      <li>%T：当前 tracker</li>
      <li>%I: 信息哈希值 v1</li>
      <li>%J：信息哈希值 v2</li>
      <li>%K: Torrent ID</li>
    </ul>

    <p>qbittorrent的设置与transmission不一样，transmission直接输入脚本路径就行，qb的不一样</p>

    <p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/3036f9fa90ef2b74.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/3036f9fa90ef2b74.png" alt="iShot_2023-03-13_14.24.20.png" class="lazyload" data-proofer-ignore></a></p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> bash /var/qb/btadd.sh <span class="s2">"%N"</span> <span class="s2">"%F"</span> <span class="s2">"%R"</span> <span class="s2">"%D"</span> <span class="s2">"%C"</span> <span class="s2">"%Z"</span> <span class="s2">"%I"</span> <span class="s2">"%J"</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>参数的传入次序很重要，在脚本中我们要用这个次序接收参数：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre> <span class="c">#!/bin/sh</span>
    
 <span class="nv">torrent_name</span><span class="o">=</span><span class="nv">$1</span>
 <span class="nv">content_dir</span><span class="o">=</span><span class="nv">$2</span>
 <span class="nv">root_dir</span><span class="o">=</span><span class="nv">$3</span>
 <span class="nv">save_dir</span><span class="o">=</span><span class="nv">$4</span>
 <span class="nv">files_num</span><span class="o">=</span><span class="nv">$5</span>
 <span class="nv">torrent_size</span><span class="o">=</span><span class="nv">$6</span>
 <span class="nv">file_hash</span><span class="o">=</span><span class="nv">$7</span>
 <span class="nv">file_hash2</span><span class="o">=</span><span class="nv">$8</span>
 <span class="nv">label</span><span class="o">=</span><span class="nv">$9</span>
 ......
</pre></td></tr></tbody></table></code></div>    </div>

    <p>我的qbittorrent脚本：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
</pre></td><td class="rouge-code"><pre> <span class="c">#!/bin/sh</span>
    
 <span class="nv">torrent_name</span><span class="o">=</span><span class="nv">$1</span>
 <span class="nv">content_dir</span><span class="o">=</span><span class="nv">$2</span>
 <span class="nv">root_dir</span><span class="o">=</span><span class="nv">$3</span>
 <span class="nv">save_dir</span><span class="o">=</span><span class="nv">$4</span>
 <span class="nv">files_num</span><span class="o">=</span><span class="nv">$5</span>
 <span class="nv">torrent_size</span><span class="o">=</span><span class="nv">$6</span>
 <span class="nv">file_hash</span><span class="o">=</span><span class="nv">$7</span>
 <span class="nv">file_hash2</span><span class="o">=</span><span class="nv">$8</span>
 <span class="nv">label</span><span class="o">=</span><span class="nv">$9</span>
    
 <span class="nv">totalsize</span><span class="o">=</span><span class="k">${</span><span class="nv">torrent_size</span><span class="k">}</span>
    
 <span class="k">if</span> <span class="o">[</span> 1024 <span class="nt">-gt</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then </span><span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$totalsize</span><span class="s2">"</span>B
 <span class="k">elif</span> <span class="o">[</span> 1048576 <span class="nt">-gt</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then
        </span><span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span>  <span class="s2">"scale=3; a = </span><span class="nv">$totalsize</span><span class="s2"> / 1024 ; if (length(a)==scale(a)) print 0;print a"</span>  | bc <span class="sb">`</span>
 	<span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$size</span><span class="s2">"</span>KB
 <span class="k">elif</span> <span class="o">[</span> 1073741824 <span class="nt">-gt</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then
        </span><span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span>  <span class="s2">"scale=3; a = </span><span class="nv">$totalsize</span><span class="s2"> / 1048576 ; if (length(a)==scale(a)) print 0;print a"</span>  | bc <span class="sb">`</span>
 	<span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$size</span><span class="s2">"</span>MB
 <span class="k">elif</span> <span class="o">[</span> 1073741824 <span class="nt">-le</span> <span class="nv">$totalsize</span> <span class="o">]</span><span class="p">;</span>
        <span class="k">then
        </span><span class="nv">size</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span>  <span class="s2">"scale=3; a = </span><span class="nv">$totalsize</span><span class="s2"> / 1073741824 ; if (length(a)==scale(a)) print 0;print a"</span>  | bc <span class="sb">`</span>
 	<span class="nv">size</span><span class="o">=</span><span class="s2">"</span><span class="nv">$size</span><span class="s2">"</span>GB
 <span class="k">else
        </span><span class="nv">size</span><span class="o">=</span><span class="s2">"0"</span>
         <span class="k">fi
    
 </span><span class="nv">PROXY</span><span class="o">=</span>/usr/bin/proxychains4
 <span class="nv">NAIL</span><span class="o">=</span>/usr/bin/s-nail
    
 <span class="nv">TMPFILETG</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span> <span class="nt">-t</span> qbittorent.XXXXXXXXXX<span class="si">)</span>
 <span class="nv">TOKEN</span><span class="o">=</span><span class="k">***********</span>:<span class="k">***************************</span>
 <span class="nv">chat_ID</span><span class="o">=</span>-<span class="k">*************</span>
    
 <span class="nb">cat</span> <span class="o">&gt;</span> <span class="nv">$TMPFILETG</span> <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh">
 *亲，有个磁力🧲播种完成了，功德加一!*
 ---
 客户端：qBittorent 4.5.2
 磁力名称：</span><span class="k">${</span><span class="nv">torrent_name</span><span class="k">}</span><span class="sh">，
 磁力大小：</span><span class="k">${</span><span class="nv">size</span><span class="k">}</span><span class="sh">，
 保存地址：</span><span class="k">${</span><span class="nv">save_dir</span><span class="k">}</span><span class="sh">，
 磁力链接：*magnet:?xt=urn:btih:</span><span class="k">${</span><span class="nv">file_hash</span><span class="k">}</span><span class="sh">*，
 添加时间：</span><span class="si">$(</span><span class="nb">date</span> <span class="s1">'+%Y-%m-%d %H:%M:%S'</span><span class="si">)</span><span class="sh">，
 发扬互联网精神，抵制迅雷吸血💩。
 发扬互联网精神,让每一个种子都生根发芽❀。
 [动图番号：SSNI-784](https://qcc.woimg.net/images/2020/10/06/ssni-784-1.gif)
</span><span class="no"> EOF
    
</span> <span class="nv">DATA</span><span class="o">=</span><span class="sb">`</span><span class="nb">cat</span> <span class="nv">$TMPFILETG</span><span class="sb">`</span>
    
 <span class="nv">MODE</span><span class="o">=</span><span class="s1">'Markdown'</span>
 <span class="nv">URL</span><span class="o">=</span><span class="s2">"https://api.telegram.org/bot</span><span class="k">${</span><span class="nv">TOKEN</span><span class="k">}</span><span class="s2">/sendMessage"</span>
    
 <span class="nv">$PROXY</span> curl <span class="nt">-s</span> <span class="nt">-o</span> /dev/null <span class="nt">-X</span> POST <span class="nv">$URL</span> <span class="nt">-d</span> <span class="nv">chat_id</span><span class="o">=</span><span class="k">${</span><span class="nv">chat_ID</span><span class="k">}</span> <span class="nt">-d</span> <span class="nv">parse_mode</span><span class="o">=</span><span class="k">${</span><span class="nv">MODE</span><span class="k">}</span> <span class="nt">-d</span> <span class="nv">text</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">DATA</span><span class="k">}</span><span class="s2">"</span>
    
 <span class="c">#TO_ADDR为你要通知的邮箱</span>
 <span class="nv">TO_ADDR1</span><span class="o">=</span><span class="s2">"********@gmail.com"</span>
 <span class="nv">TO_ADDR2</span><span class="o">=</span><span class="s2">"***********@qq.com"</span>
    
 <span class="nv">SUBJECT</span><span class="o">=</span><span class="s2">"亲，有个磁力🧲播种完成了，功德加一!"</span>
    
 <span class="nv">$NAIL</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$SUBJECT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$TO_ADDR1</span><span class="s2">"</span> &lt; <span class="s2">"</span><span class="nv">$TMPFILETG</span><span class="s2">"</span>
 <span class="nv">$NAIL</span> <span class="nt">-s</span> <span class="s2">"</span><span class="nv">$SUBJECT</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$TO_ADDR2</span><span class="s2">"</span> &lt; <span class="s2">"</span><span class="nv">$TMPFILETG</span><span class="s2">"</span>
    
 <span class="nb">rm</span> <span class="s2">"</span><span class="nv">$TMPFILETG</span><span class="s2">"</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<h4 id="1913-安装transmission"><span class="me-2">19.1.3 安装transmission</span><a href="#1913-安装transmission" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p>安装</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>add-apt-repository ppa:ubuntuhandbook1/transmission <span class="c">#最新版PPA</span>
    
 <span class="nb">sudo </span>apt-fast update
    
 <span class="nb">sudo </span>apt-fast <span class="nb">install </span>transmission
 <span class="nb">sudo </span>apt-fast <span class="nb">install </span>transmission-daemon
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>修改配置</p>

    <p>修改之前停止<code class="language-plaintext highlighter-rouge">transmission-daemon</code>服务，不然会回滚：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>service transmission-daemon stop
</pre></td></tr></tbody></table></code></div>    </div>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>nano /var/lib/transmission-daemon/info/settings.json
</pre></td></tr></tbody></table></code></div>    </div>

    <p>修改：</p>

    <div class="language-json highlighter-rouge"><div class="code-header">
        <span data-label-text="JSON"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="w"> </span><span class="p">{</span><span class="w">
 		</span><span class="err">......</span><span class="w">
 		</span><span class="nl">"blocklist-enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="err">#黑名单列表</span><span class="w">
     </span><span class="nl">"blocklist-url"</span><span class="p">:</span><span class="s2">"https://cors.isteed.cc/github.com/ttgapers/transmission-blocklist/releases/download/untagged-529f8302ad5115daf99a/blocklist.gz"</span><span class="w">
     </span><span class="err">......</span><span class="w">
     </span><span class="nl">"rpc-authentication-required"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
     </span><span class="nl">"rpc-bind-address"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.0.0.0"</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"123456"</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-port"</span><span class="p">:</span><span class="w"> </span><span class="mi">9091</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/transmission/"</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"transmission"</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-whitelist"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w"> 
     </span><span class="nl">"rpc-whitelist-enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> 
     </span><span class="err">......</span><span class="w">
 		</span><span class="nl">"script-torrent-done-enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
     </span><span class="nl">"script-torrent-done-filename"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/btmail.sh"</span><span class="p">,</span><span class="err">#邮件通知脚本</span><span class="w">
     </span><span class="nl">"script-torrent-added-enabled"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
     </span><span class="nl">"script-torrent-added-filename"</span><span class="p">:</span><span class="s2">"/btadd.sh"</span><span class="p">,</span><span class="err">#添加任务后运行脚本</span><span class="w">
     </span><span class="nl">"script-torrent-done-seeding-enabled"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
     </span><span class="nl">"script-torrent-done-seeding-filename"</span><span class="p">:</span><span class="s2">"/btseed.sh"</span><span class="p">,</span><span class="err">#任务完成后通知脚本</span><span class="w">
 		</span><span class="err">......</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>更改WEB-UI</p>

    <p>以下方法弃用：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> wget https://gitee.com/culturist/transmission-web-control/raw/master/release/install-tr-control-gitee.sh
 <span class="nb">sudo </span>bash install-tr-control-gitee.sh
</pre></td></tr></tbody></table></code></div>    </div>

    <p>如果过程中有如下错误：<code class="language-plaintext highlighter-rouge">cp: cannot stat '/tmp/tr-web-control/transmission-web-control/src/.': No such file or directory</code> 则需要自行创建文件。</p>

    <p>首先将第一步下载的文件解压复制到<code class="language-plaintext highlighter-rouge">/tmp/tr-web-control</code> 路径下，然后运行<code class="language-plaintext highlighter-rouge">chmod -R 777 /tmp/tr-web-control/transmission-web-control/src/</code> ，最后再运行上述脚本。</p>

    <p>最后，开启服务：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>service transmission-daemon start
</pre></td></tr></tbody></table></code></div>    </div>

    <p><strong>新方法：</strong></p>

    <aside>
 💡 上述脚本对于最新客户端不生效，一直提示连接失败，因为最新的客户端的网页文件夹名字改为了`public_html` 而不是`web` 。
    
 </aside>

    <p>直接下载主题文件：</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre> wget https://proxy.zyun.vip/https://github.com/ronggang/transmission-web-control/archive/refs/tags/v1.6.1-update1.zip
 unzip transmission-web-control-1.6.1-update1.zip <span class="c">#解压出来，用啥工具都行</span>
 <span class="nb">cd </span>transmission-web-control-1.6.1-update1 <span class="c">#进入目录</span>
    
 <span class="nb">sudo rm</span> /usr/share/transmission/public_html <span class="c">#删除本来的public文件夹</span>
 <span class="nb">sudo cp</span> <span class="nt">-r</span> src /usr/share/transmission/public_html <span class="c">#复制 </span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
</ol>

<h4 id="1924-效果"><span class="me-2">19.2.4 效果</span><a href="#1924-效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/aa5482dfbccd27d2.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/aa5482dfbccd27d2.png" alt="iShot_2023-03-13_11.51.01.png" class="lazyload" data-proofer-ignore></a></p>

<h4 id="1925-安装qbittorrent"><span class="me-2">19.2.5 安装qBittorrent</span><a href="#1925-安装qbittorrent" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<ol>
  <li>
    <p>安装add-apt-repository命令(非必需)</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get <span class="nb">install </span>software-properties-common <span class="nt">-y</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>添加qbittorrent-nox的PPA软件源</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre> <span class="c"># qBittorrent 稳定版</span>
 <span class="nb">sudo </span>add-apt-repository ppa:qbittorrent-team/qbittorrent-stable
    
 <span class="c"># qBittorrent 测试版</span>
 <span class="nb">sudo </span>add-apt-repository ppa:qbittorrent-team/qbittorrent-unstable
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>安装qbittorrent-nox</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>apt-get update <span class="o">&amp;&amp;</span> <span class="nb">sudo </span>apt-get <span class="nb">install </span>qbittorrent-nox <span class="nt">-y</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>设置开机启动</p>

    <div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="nb">sudo </span>apt-get <span class="nb">install </span>vim <span class="nt">-y</span> <span class="o">&amp;&amp;</span> vim /etc/systemd/system/qbittorrent-nox.service
</pre></td></tr></tbody></table></code></div>    </div>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre> <span class="pi">[</span><span class="nv">Unit</span><span class="pi">]</span>
    
 <span class="s">Description=qBittorrent-nox</span>
    
 <span class="s">After=network.target</span>
    
 <span class="s">[Service]</span>
    
 <span class="s">User=root</span>
    
 <span class="s">Type=forking</span>
    
 <span class="s">RemainAfterExit=yes</span>
    
 <span class="s">ExecStart=/usr/bin/qbittorrent-nox -d</span>
    
 <span class="s">[Install]</span>
    
 <span class="s">WantedBy=multi-user.target</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>修改qbittorrent-nox.service文件后重新载入</p>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="s">sudo systemctl daemon-reload</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>启动和停止</p>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre> <span class="s">sudo systemctl start qbittorrent-nox</span>
 <span class="s">sudo systemctl stop qbittorrent-nox</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>开机自启</p>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="s">sudo systemctl enable qbittorrent-nox</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>验证</p>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre> <span class="s">默认账号：admin 密码：adminadmin</span>
    
 <span class="s">默认登陆网址：http://ip:8080</span>
</pre></td></tr></tbody></table></code></div>    </div>
  </li>
  <li>
    <p>ip国家不显示问题的解决</p>

    <p>下载文件：</p>

    <p><a href="https://pan.rainsin.cn/s/s84u65">dbip-country-lite.mmdb</a></p>

    <p>先进入root用户：</p>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="s">su</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>将文件复制到qbittorrent目录（下面的目标路径是用<code class="language-plaintext highlighter-rouge">sudo apt</code>安装qb时所用路径，其他的自行寻找）：</p>

    <div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre> <span class="s">cp 你的dbip-county-lite.mmdb路径 /root/.local/share/qBittorrent/dbip-county-lite.mmdb</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>重启服务即可。</p>

    <p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/008fdd809cd52644.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/008fdd809cd52644.png" alt="Snipaste_2023-03-14_14-27-48.png" class="lazyload" data-proofer-ignore></a></p>
  </li>
</ol>

<p>最后反向代理，完成。</p>

<h4 id="1926-效果"><span class="me-2">19.2.6 效果</span><a href="#1926-效果" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><a href="https://photo.rainsin.cn:2000/LightPicture/2023/06/f0ad94fdc2a44d61.png" class="popup img-link "><img data-src="https://photo.rainsin.cn:2000/LightPicture/2023/06/f0ad94fdc2a44d61.png" alt="iShot_2023-03-13_11.52.49.png" class="lazyload" data-proofer-ignore></a></p>

<h2 id="20-设置clash代理"><span class="me-2">20 设置clash代理</span><a href="#20-设置clash代理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<h3 id="clash-下载"><span class="me-2">Clash 下载</span><a href="#clash-下载" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>在 Clash <a href="https://github.com/Dreamacro/clash/releases">release</a> 页面下载相应的版本，对于 Ubuntu 一般使用 <a href="https://github.com/Dreamacro/clash/releases/download/v1.9.0/clash-linux-amd64-v1.9.0.gz">clash-linux-amd64-vX.X.X.gz</a> 版本：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>wget https://github.com/Dreamacro/clash/releases/download/v1.10.0/clash-linux-arm64-v1.10.0.gz
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>如果直接 wget 速度较慢的话，可以本地下载完成后，使用 SFTP 上传到 Linux 服务器。</p>

</blockquote>

<p>然后使用 <code class="language-plaintext highlighter-rouge">gunzip</code> 命令解压，并重命名为 <code class="language-plaintext highlighter-rouge">clash</code>：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">gunzip </span>clash-linux-amd64-v1.10.0.gz
<span class="nb">mv </span>clash-linux-amd64-v1.10.0 clash
</pre></td></tr></tbody></table></code></div></div>

<p>为 clash 添加可执行权限：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">chmod </span>u+x clash
</pre></td></tr></tbody></table></code></div></div>

<p>Clash 运行时需要 <code class="language-plaintext highlighter-rouge">Country.mmdb</code> 文件，当第一次启动 Clash 时（使用 <code class="language-plaintext highlighter-rouge">./clash</code> 命令） 会自动下载（会下载至 <code class="language-plaintext highlighter-rouge">/home/XXX/.config/clash</code> 文件夹下）。自动下载可能会因网络原因较慢，可以访问该<a href="https://github.com/Dreamacro/maxmind-geoip/releases">链接</a>手动下载。</p>

<blockquote>
  <p>Country.mmdb 文件利用 GeoIP2 服务能识别互联网用户的地点位置，以供规则分流时使用。</p>

</blockquote>

<h3 id="配置文件"><span class="me-2">配置文件</span><a href="#配置文件" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>一般的网络服务提供了 Clash 订阅链接，可以直接下载链接指向的文件内容，保存到 <code class="language-plaintext highlighter-rouge">config.yaml</code> 中。或者使用订阅转换服务（如该<a href="https://converter.niallapi.top/">链接</a>。也可以自行搭建，可参考<a href="https://codeswift.top/posts/docker-subscription-converter/">该文章</a>），将其它订阅转换为 Clash 订阅。</p>

<p>这里推荐使用订阅转换服务，转换后的配置文件已添加更为强大的分流规则。就可以将 Clash 一直保持后台运行，自动分流，且会自动选择最优节点。</p>

<blockquote>
  <p>Clash 配置文件的完整参数介绍见官方文档。</p>

</blockquote>

<blockquote>
  <p>如果使用订阅转换服务，对于转换后的订阅链接，可以使用以下命令来下载配置文件：</p>

</blockquote>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-o</span> config.yaml <span class="s1">'longURL'</span>
</pre></td></tr></tbody></table></code></div></div>

<p>对于 <code class="language-plaintext highlighter-rouge">suo.yt</code> 短链接，需要重定向，因此使用以下命令来下载配置文件：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>curl <span class="nt">-L</span> <span class="nt">-o</span> config.yaml <span class="s1">'shortURL'</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="clash-as-a-daemon"><span class="me-2">Clash as a daemon</span><a href="#clash-as-a-daemon" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>将 Clash 转变为系统服务，从而使得 Clash 实现常驻后台运行、开机自启动等。</p>

<blockquote>
  <p>普通用户需要 sudo 权限。</p>

</blockquote>

<h4 id="配置-systemd-服务"><span class="me-2">配置 systemd 服务</span><a href="#配置-systemd-服务" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Linux 系统使用 systemd 作为启动服务器管理机制，首先把 Clash 可执行文件拷贝到 <code class="language-plaintext highlighter-rouge">/usr/local/bin</code> 目录，相关配置拷贝到 <code class="language-plaintext highlighter-rouge">/etc/clash</code> 目录。</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="nb">sudo mkdir</span> /etc/clash
<span class="nb">sudo cp </span>clash /usr/local/bin
<span class="nb">sudo cp </span>config.yaml /etc/clash/
<span class="nb">sudo cp </span>Country.mmdb /etc/clash/
</pre></td></tr></tbody></table></code></div></div>

<p>创建 systemd 服务配置文件 <code class="language-plaintext highlighter-rouge">sudo vim /etc/systemd/system/clash.service</code>：</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="pi">[</span><span class="nv">Unit</span><span class="pi">]</span>
<span class="s">Description=Clash daemon, A rule-based proxy in Go.</span>
<span class="s">After=network.target</span>

<span class="pi">[</span><span class="nv">Service</span><span class="pi">]</span>
<span class="s">Type=simple</span>
<span class="s">Restart=always</span>
<span class="s">ExecStart=/usr/local/bin/clash -d /etc/clash</span>

<span class="pi">[</span><span class="nv">Install</span><span class="pi">]</span>
<span class="s">WantedBy=multi-user.target</span>
</pre></td></tr></tbody></table></code></div></div>

<h4 id="使用-systemctl"><span class="me-2">使用 systemctl</span><a href="#使用-systemctl" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl daemon-reload
</pre></td></tr></tbody></table></code></div></div>

<p>使用以下命令，让 Clash 开机自启动：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl <span class="nb">enable </span>clash
</pre></td></tr></tbody></table></code></div></div>

<p>然后开启 Clash：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl start clash
</pre></td></tr></tbody></table></code></div></div>

<p>查看 Clash 日志：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl status clash
<span class="nb">sudo </span>journalctl <span class="nt">-xe</span>
</pre></td></tr></tbody></table></code></div></div>

<h3 id="使用代理"><span class="me-2">使用代理</span><a href="#使用代理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<h4 id="利用-export-命令使用代理"><span class="me-2">利用 <code class="language-plaintext highlighter-rouge">Export</code> 命令使用代理</span><a href="#利用-export-命令使用代理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>Clash 运行后，其在后台监听某一端口。Ubuntu 下使用代理，需要 <code class="language-plaintext highlighter-rouge">export</code> 命令。根据 config 配置文可以查看到件Clash 代理端口（订阅转换后，端口为7890），设置系统代理命令为：</p>

<p>可以将该命令添加到 <code class="language-plaintext highlighter-rouge">.bashrc</code> 中，登陆后该用户自动开启代理。</p>

<p>取消系统代理：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">unset  </span>http_proxy  https_proxy  all_proxy
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>一般下载数据集时，记得取消代理。</p>

</blockquote>

<h4 id="dashboard-外部控制"><span class="me-2">DashBoard 外部控制</span><a href="#dashboard-外部控制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p>外部控制端口为 9090，因此也可以访问该<a href="http://clash.razord.top/">链接</a>，输入 IP 地址（需本机可以访问的 IP）以及端口号 9090，来进入 Clash Dashboard 进行节点的选择。也可以在服务器自行搭建 Clash Dashboard，请参见<a href="https://github.com/Dreamacro/clash-dashboard">该项目</a>。不过 Clash Dashboard 用处不大，使用<strong>订阅转换</strong>后的配置文件包含了自动选择的功能，Clash 会自动选择延迟最低的节点。</p>

<h4 id="设置密码"><span class="me-2">设置密码</span><a href="#设置密码" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

<p><code class="language-plaintext highlighter-rouge">export</code> 命令其他用户执行后也可以使用该代理，此时通过可以更换代理端口、添加密码等措施加以限制。修改 <code class="language-plaintext highlighter-rouge">/etc/clash/config.yaml</code> 文件部分配置：</p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="na">mixed-port</span><span class="pi">:</span> <span class="m">12345</span>
<span class="na">authentication</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">用户名1:密码1"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">用户名2:密码2"</span>
<span class="na">allow-lan</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">mode</span><span class="pi">:</span> <span class="s">Rule</span>
<span class="na">log-level</span><span class="pi">:</span> <span class="s">info</span>
<span class="na">external-controller</span><span class="pi">:</span> <span class="s">:9090</span>
</pre></td></tr></tbody></table></code></div></div>

<p><code class="language-plaintext highlighter-rouge">mixed-port: 12345</code> 就是混合代理端口，即使用代理时所指定的端口。然后需要重启 Clash，命令为：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl restart clash
</pre></td></tr></tbody></table></code></div></div>

<p>根据上述配置文件，<code class="language-plaintext highlighter-rouge">export</code> 命令变为</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://用户名1:密码1@127.0.0.1:12345 <span class="nv">http_proxy</span><span class="o">=</span>http://用户名1:密码1@127.0.0.1:12345 <span class="nv">all_proxy</span><span class="o">=</span>socks5://用户名1:密码1@127.0.0.1:12345
</pre></td></tr></tbody></table></code></div></div>

<h3 id="tun-模式"><span class="me-2">TUN 模式</span><a href="#tun-模式" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<p>新版的 Clash Premium 内核支持 TUN 模式，且目前已支持 Linux 系统下的 <code class="language-plaintext highlighter-rouge">auto-route</code> 和 <code class="language-plaintext highlighter-rouge">auto-detect-interface</code>，无需手动设置转发表，可以方便快捷的实现 <strong>透明网关（旁路由）</strong> 的功能。</p>

<p>首先需要下载 <a href="https://github.com/Dreamacro/clash/releases/tag/premium">Clash Premium</a> 版本，替换上面的 <code class="language-plaintext highlighter-rouge">clash</code> 文件。接着需要设置 Linux 系统，开启转发功能。编辑文件 <code class="language-plaintext highlighter-rouge">/etc/sysctl.conf</code>，添加以下内容：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>net.ipv4.ip_forward<span class="o">=</span>1
</pre></td></tr></tbody></table></code></div></div>

<p>保存退出后，执行以下命令使修改生效：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>sysctl <span class="nt">-p</span>
</pre></td></tr></tbody></table></code></div></div>

<p>然后接着需要关闭系统的 DNS 服务，使用以下命令：</p>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nb">sudo </span>systemctl stop systemd-resolved
<span class="nb">sudo </span>systemctl disable systemd-resolved
</pre></td></tr></tbody></table></code></div></div>

<blockquote>
  <p>关于代理环境下 DNS 解析行为的深入探讨，可以参见浅谈在代理环境中的 DNS 解析行为以及我有特别的 DNS 配置和使用技巧。</p>

</blockquote>

<p>接着需要设置 Clash 的配置文件，添加以下内容：</p>

<div class="language-plaintext highlighter-rouge"><div class="code-header">
        <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre>dns:
  enable: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  nameserver:
    - 114.114.114.114
  fallback:
    - 8.8.8.8
tun:
  enable: true
  stack: system # or gvisor
  dns-hijack:
    - 8.8.8.8:53
    - tcp://8.8.8.8:53
    - any:53
    - tcp://any:53
  auto-route: true # auto set global route
  auto-detect-interface: true # conflict with interface-nam
</pre></td></tr></tbody></table></code></div></div>

<p>最后重启 Clash 服务即可，这样流量就会通过 TUN 接口转发，同时利用强大的分流规则，实现按需代理。也可以设置局域网内的网关地址和 DNS 服务器地址，实现透明网关。</p>

<h2 id="21-服务器状态监控"><span class="me-2">21 服务器状态监控</span><a href="#21-服务器状态监控" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<div class="language-bash highlighter-rouge"><div class="code-header">
        <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker run <span class="nt">--restart</span> unless-stopped <span class="nt">-it</span> <span class="nt">-d</span> <span class="nt">--name</span> ward <span class="nt">-p</span> 4000:4000 <span class="nt">-e</span> <span class="nv">WARD_PORT</span><span class="o">=</span>4000 <span class="nt">-e</span> <span class="nv">WARD_THEME</span><span class="o">=</span>dark <span class="nt">--privileged</span> antonyleons/ward
</pre></td></tr></tbody></table></code></div></div>

<h2 id="22-gitea安装"><span class="me-2">22 Gitea安装</span><a href="#22-gitea安装" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2>

<p>文件：<code class="language-plaintext highlighter-rouge">docker-compose.yml</code></p>

<div class="language-yaml highlighter-rouge"><div class="code-header">
        <span data-label-text="YAML"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre></td><td class="rouge-code"><pre><span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">3"</span>

<span class="na">networks</span><span class="pi">:</span>
  <span class="na">gitea</span><span class="pi">:</span>
    <span class="na">external</span><span class="pi">:</span> <span class="kc">false</span>

<span class="na">services</span><span class="pi">:</span>
  <span class="na">server</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">gitea/gitea:1.19.0</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">gitea</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">USER_UID=1000</span>
      <span class="pi">-</span> <span class="s">USER_GID=1000</span>
      <span class="pi">-</span> <span class="s">GITEA__database__DB_TYPE=mysql</span>
      <span class="pi">-</span> <span class="s">GITEA__database__HOST=db:3306</span>
      <span class="pi">-</span> <span class="s">GITEA__database__NAME=gitea</span>
      <span class="pi">-</span> <span class="s">GITEA__database__USER=gitea</span>
      <span class="pi">-</span> <span class="s">GITEA__database__PASSWD=gitea</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">gitea</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/home/ubuntu/pdata/gitea:/data</span>
      <span class="pi">-</span> <span class="s">/home/ubuntu/pdata/gitea/timezone:/etc/timezone:ro</span>
      <span class="pi">-</span> <span class="s">/home/ubuntu/pdata/gitea/localtime:/etc/localtime:ro</span>
    <span class="na">ports</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">222:22"</span>
    <span class="na">depends_on</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">db</span>

  <span class="na">db</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:8</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">environment</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">MYSQL_ROOT_PASSWORD=gitea</span>
      <span class="pi">-</span> <span class="s">MYSQL_USER=gitea</span>
      <span class="pi">-</span> <span class="s">MYSQL_PASSWORD=gitea</span>
      <span class="pi">-</span> <span class="s">MYSQL_DATABASE=gitea</span>
    <span class="na">networks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">gitea</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">/home/ubuntu/pdata/gitea/mysql:/var/lib/mysql</span>
</pre></td></tr></tbody></table></code></div></div>


</div>

<div class="post-tail-wrapper text-muted">

  <!-- categories -->
  
  <div class="post-meta mb-3">
    <i class="far fa-folder-open fa-fw me-1"></i>
    
      <a href='/categories/server/'>Server</a>,
      <a href='/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/'>音视频</a>
  </div>
  

  <!-- tags -->
  
  <div class="post-tags">
    <i class="fa fa-tags fa-fw me-1"></i>
      
      <a href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/"
          class="post-tag no-text-decoration" >树莓派</a>
      
      <a href="/tags/%E6%B5%81%E7%A8%8B/"
          class="post-tag no-text-decoration" >流程</a>
      
      <a href="/tags/ubuntu/"
          class="post-tag no-text-decoration" >ubuntu</a>
      
      <a href="/tags/emby/"
          class="post-tag no-text-decoration" >Emby</a>
      
      <a href="/tags/gitea/"
          class="post-tag no-text-decoration" >Gitea</a>
      
      <a href="/tags/apache/"
          class="post-tag no-text-decoration" >Apache</a>
      
      <a href="/tags/docker/"
          class="post-tag no-text-decoration" >Docker</a>
      
      <a href="/tags/bt/"
          class="post-tag no-text-decoration" >Bt</a>
      
      <a href="/tags/bot/"
          class="post-tag no-text-decoration" >Bot</a>
      
  </div>
  

  <div class="post-tail-bottom
    d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
    <div class="license-wrapper">

      

        

        本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权

      
    </div>

    <!-- Post sharing snippet -->

<div class="share-wrapper">
  <span class="share-label text-muted me-1">分享</span>
  <span class="share-icons">
    
    
    

    
      
      <a
        href="https://twitter.com/intent/tweet?text=%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BD%B1%E8%A7%86%E5%BA%93%E5%92%8C%E5%90%84%E7%A7%8D%E6%9C%8D%E5%8A%A1%20-%20Rainsin%20%E2%80%A2%20Blog&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fserver-config%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Twitter"
        target="_blank"
        rel="noopener"
        aria-label="Twitter"
      >
        <i class="fa-fw fab fa-twitter"></i>
      </a>
    
      
      <a
        href="https://www.facebook.com/sharer/sharer.php?title=%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BD%B1%E8%A7%86%E5%BA%93%E5%92%8C%E5%90%84%E7%A7%8D%E6%9C%8D%E5%8A%A1%20-%20Rainsin%20%E2%80%A2%20Blog&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fserver-config%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Facebook"
        target="_blank"
        rel="noopener"
        aria-label="Facebook"
      >
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a
        href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2Fserver-config%2F&text=%E5%88%9B%E5%BB%BA%E8%87%AA%E5%B7%B1%E7%9A%84%E5%BD%B1%E8%A7%86%E5%BA%93%E5%92%8C%E5%90%84%E7%A7%8D%E6%9C%8D%E5%8A%A1%20-%20Rainsin%20%E2%80%A2%20Blog"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Telegram"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
      >
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <i
      id="copy-link"
      class="fa-fw fas fa-link small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
    </i>
  </span>
</div>


  </div><!-- .post-tail-bottom -->

</div><!-- div.post-tail-wrapper -->


      
    
      
    </div>
  </div>
  <!-- #core-wrapper -->

  <!-- panel -->
  <div id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
    <div class="access">
      <!-- Get the last 5 posts from lastmod list. -->














  <div id="access-lastmod" class="post">
    <div class="panel-heading">最近更新</div>
    <ul class="post-content list-unstyled ps-0 pb-1 ms-1 mt-2">
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/server-config/">创建自己的影视库和各种服务</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/mandelbrot/">分形图形的一个项目（曼德布罗集和朱莉娅集）</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/mystery/">奇怪的，阴谋论的</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/cube/">魔方练习中的各种工具</a>
        </li>
      
        
        
        
        <li class="text-truncate lh-lg">
          <a href="/posts/lindan/">绝佳的学习视频：2014年丹麦公开赛林丹VS周天成低视角高清录像</a>
        </li>
      
    </ul>
  </div>
  <!-- #access-lastmod -->


      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">热门标签</div>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/">解决问题</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/efi/">EFI</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/">黑苹果</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/apache/">Apache</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api/">API</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bot/">Bot</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bt/">Bt</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/debian/">Debian</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deepin/">Deepin</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
      
    </div>
  </div>


    </div>

    
      
      



  <div id="toc-wrapper" class="ps-0 pe-4 mb-5">
    <div class="panel-heading ps-3 pt-2 mb-2">文章内容</div>
    <nav id="toc"></nav>
  </div>


    
  </div>
</div>

<!-- tail -->

  <div class="row">
    <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-3 pe-xl-4 mt-5">
      
        
        <!--
  Recommend the other 3 posts according to the tags and categories of the current post,
  if the number is not enough, use the other latest posts to supplement.
-->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->








  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  
    





<!-- Fill with the other newlest posts -->



  
    
    
      
      
        
        
        
      
    
  
    
    
      
      
        
        
        
      
    
  
    
    
      
      
        
        
        
          



  <div id="related-posts" class="mb-2 mb-sm-4">
    <h3 class="pt-2 mb-4 ms-1" data-toc-skip>
      相关文章
    </h3>
    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        
        
        <div class="col">
          <a href="/posts/cube/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1719217930"
  data-df="YYYY/MM/DD"
  
>
  2024/06/24
</em>

              <h4 class="pt-0 my-2" data-toc-skip>魔方练习中的各种工具</h4>
              <div class="text-muted small">
                <p>
                  





                  





公式显示器



  公式来源speedcubedb。这个小工具是我一时兴起做的，数据是从网站上扒下来的，会有很多错误，容我慢慢改，后续会对公式进行分类。





  具体的OLL手法参见：【经典重制】 菲神OLL 全网唯一4K60帧版本 挑战画质巅峰 CubeSkills 
具体的PLL手法参见：【经典重制】 菲神PLL 全网唯一4K60帧版本 挑战画质巅峰 CubeSkil...
                </p>
              </div>
            </div>
          </a>
        </div>
      
        
        
        <div class="col">
          <a href="/posts/mandelbrot/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1719217930"
  data-df="YYYY/MM/DD"
  
>
  2024/06/24
</em>

              <h4 class="pt-0 my-2" data-toc-skip>分形图形的一个项目（曼德布罗集和朱莉娅集）</h4>
              <div class="text-muted small">
                <p>
                  





                  





分形



  左边为曼德勃罗集（Mandelbrot Set），右边为对应坐标的朱莉亚集（Julia Set）。原项目地址为：Mandelbrot-maps，我觉得挺好玩就贴在这里了。



  点击指南针将图案摆正。鼠标滚轮缩放图案，按住鼠标左键移动图案。





  




  如果想知道这两个分形相关的知识可以参看教程。





                </p>
              </div>
            </div>
          </a>
        </div>
      
        
        
        <div class="col">
          <a href="/posts/lindan/" class="card post-preview h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->





<em
  class="small"
  data-ts="1712219530"
  data-df="YYYY/MM/DD"
  
>
  2024/04/04
</em>

              <h4 class="pt-0 my-2" data-toc-skip>绝佳的学习视频：2014年丹麦公开赛林丹VS周天成低视角高清录像</h4>
              <div class="text-muted small">
                <p>
                  





                  


  
  全场高清录像下载链接：夸克网盘 、One Drive(密码：lindan66)、Google Drive、自己的服务(IPv6)。
  
  
    右手打球的可以镜像视频进行学习：显示设置 -&amp;gt; 画面翻转 -&amp;gt; 水平。我的Safari浏览器无法播放，Chrome和火狐可以，移动端大概率无法播放。
  
  
    剪辑视频来自up: mcwawa。
  

...
                </p>
              </div>
            </div>
          </a>
        </div>
      
    </div>
    <!-- .card-deck -->
  </div>
  <!-- #related-posts -->


      
        
        <!-- Navigation buttons at the bottom of the post. -->

<div class="post-navigation d-flex justify-content-between">
  
    <div
      class="btn btn-outline-primary disabled"
      prompt="上一篇"
    >
      <p>-</p>
    </div>
  

  
    <a
      href="/posts/ax200-bluetooth/"
      class="btn btn-outline-primary"
      prompt="下一篇"
    >
      <p>黑苹果Venture 13.4 Intel无线网卡(AX200,AX201,AX210,AX203)蓝牙问题排查</p>
    </a>
  
</div>

      
        
        <!--  The comments switcher -->



      
      <div id="tcomment"></div>
    </div>
  </div>


        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 post-content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <div id="access-tags">
    <div class="panel-heading">热门标签</div>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98/">解决问题</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/efi/">EFI</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/%E9%BB%91%E8%8B%B9%E6%9E%9C/">黑苹果</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/apache/">Apache</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/api/">API</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bot/">Bot</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/bt/">Bt</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/debian/">Debian</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/deepin/">Deepin</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/docker/">Docker</a>
      
    </div>
  </div>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>
    </div>

    <!-- The Footer -->

<footer>
  <div class="container px-lg-4">
    <div class="d-flex justify-content-center align-items-center text-muted mx-md-3" >
      <p>本站采用 Jekyll  ，主题 Chirpy ，使用 GitHub Pages部署。
      </p>

      <p>
        <a href="https://icp.gov.moe/?keyword=20240093" target="_blank">萌ICP备20240093号</a>&nbsp;©
        2024
        <a href="https://twitter.com/2000_python">RAINSIN</a>.
        
          <span
            data-bs-toggle="tooltip"
            data-bs-placement="top"
            title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
          >保留部分权利。</span>
        
      </p>
    </div>
    <div class="justify-content-center align-items-center text-muted mx-md-3" style="display: flex;  margin: 0 0 10px 0;">
      友情链接：&nbsp;&nbsp;
      <a href="https://sweetjing.cc/" target="_blank" title="一个人的寂寞，一群人的狂欢。">半截の诗</a>。
    </div>
    <div class="justify-content-center align-items-center text-muted mx-md-3" style="display: flex;  margin: 0 0 40px 0;">
      <a href="https://www.foreverblog.cn/" target="_blank" title="一个人的寂寞，一群人的狂欢。"> <img src="https://img.foreverblog.cn/logo_en_default.png" alt="" style="width:auto;height:1rem;cursor: pointer;"> </a>
      &nbsp;&nbsp;
      <a href="https://www.foreverblog.cn/go.html" target="_blank"> <img src="https://img.foreverblog.cn/wormhole_3_tp.gif" alt="" style="width:auto;height:2rem;" title="穿梭虫洞-随机访问十年之约友链博客"></a>
      &nbsp;&nbsp;
      <a href="https://blogwe.com" target="_blank" style="font-size: larger;color: #404040;font-weight: 600;white-space: 2px;">[🏠BlogWe.com]</a>
    </div>
  </div>
</footer>
<script>
  window.load_event = {
    ...window.load_event,
    comments_style: () => {
        const str = document.getElementsByClassName("tk-owo-emotion");
        for (const element of str) {
          if(element.alt.indexOf("抽象") != -1){
            element.setAttribute('style', 'width: auto');
          }
        }
    }
  };
</script>

<script>
  const handler = {
      get: (target,name) => {
        return name in target ? target[name] : "no prop!"
      },
      set: (target,prop,newval,receiver) => {
        target[prop] = newval;
        if(prop == "modeStatus" && newval == "dark"){
          const style = document.createElement("style");
          style.type = "text/css";
          style.innerHTML="#loading-gif-box{background-color: #000;} .loading-boxs-imgs{background-image: url(https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/load/darkloading.gif);}"
          document.appendChild(style);
        }
        if(prop == "modeStatus" && newval == "light"){
          const style = document.createElement("style");
          style.type = "text/css";
          style.innerHTML="#loading-gif-box{background-color: #fff;} .loading-boxs-imgs{background-image: url(https://rainsin-1305486451.file.myqcloud.com/rainsin-blog/img/load6.gif);}"
          document.appendChild(style);
        }
        return true;
      }
  };

  const mode = new Proxy(modeToggle,handler);
</script>

<script defer src="https://rainsin-1305486451.file.myqcloud.com/js%E5%BA%93/umami.js" data-website-id="202ceef1-7698-45d5-a10e-fc97f6a046c0"></script>


    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    
      <div
        id="notification"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
        data-bs-animation="true"
        data-bs-autohide="false"
      >
        <div class="toast-header">
          <button
            type="button"
            class="btn-close ms-auto"
            data-bs-dismiss="toast"
            aria-label="Close"
          ></button>
        </div>
        <div class="toast-body text-center pt-0">
          <p class="px-2 mb-3">发现新版本的内容。</p>
          <button type="button" class="btn btn-primary" aria-label="Update">
            更新
          </button>
        </div>
      </div>
    

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  

  
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
  

  
    <script src="https://cdn.staticfile.net/simple-jekyll-search/1.9.2/simple-jekyll-search.min.js"></script>
  

  
    <script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/lazysizes/5.3.2/lazysizes.min.js"></script>
  

  
    <script src="https://cdn.bootcdn.net/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js"></script>
  

  
    <script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script>
  

  
    <script src="https://cdn.staticfile.net/dayjs/1.11.10/dayjs.min.js"></script>
  

  
    <script src="https://cdn.staticfile.net/dayjs/1.11.10/locale/zh.min.js"></script>
  

  
    <script src="https://cdn.staticfile.net/dayjs/1.11.10/plugin/relativeTime.min.js"></script>
  

  
    <script src="https://cdn.staticfile.net/dayjs/1.11.10/plugin/localizedFormat.min.js"></script>
  

  
    <script src="https://cdn.bootcdn.net/ajax/libs/tocbot/4.21.1/tocbot.min.js"></script>
  

  
    <script src="https://cdn.staticfile.net/mermaid/10.7.0/mermaid.min.js"></script>
  








<script defer src="/assets/js/dist/post.min.js"></script>




    
      <!-- mermaid-js loader -->
<script type="text/javascript">
  (function () {
    function updateMermaid(event) {
      if (event.source === window && event.data && event.data.direction === ModeToggle.ID) {
        const mode = event.data.message;

        if (typeof mermaid === 'undefined') {
          return;
        }

        let expectedTheme = mode === ModeToggle.DARK_MODE ? 'dark' : 'default';
        let config = { theme: expectedTheme };

        /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */
        $('.mermaid').each(function () {
          let svgCode = $(this).prev().children().html();
          $(this).removeAttr('data-processed');
          $(this).html(svgCode);
        });

        mermaid.initialize(config);
        mermaid.init(undefined, '.mermaid');
      }
    }

    let initTheme = 'default';
    const html = document.documentElement;

    if (
      (html.hasAttribute('data-mode') && html.getAttribute('data-mode') === 'dark') ||
      (!html.hasAttribute('data-mode') && window.matchMedia('(prefers-color-scheme: dark)').matches)
    ) {
      initTheme = 'dark';
    }

    let mermaidConf = {
      theme: initTheme /* <default|dark|forest|neutral> */
    };

    /* Create mermaid tag */
    document.querySelectorAll('pre>code.language-mermaid').forEach((elem) => {
      const svgCode = elem.textContent;
      const backup = elem.parentElement;
      backup.classList.add('unloaded');
      /* create mermaid node */
      let mermaid = document.createElement('pre');
      mermaid.classList.add('mermaid');
      const text = document.createTextNode(svgCode);
      mermaid.appendChild(text);
      backup.after(mermaid);
    });

    mermaid.initialize(mermaidConf);

    window.addEventListener('message', updateMermaid);
  })();
</script>

    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '<div class="px-1 px-sm-2 px-lg-4 px-xl-0">  <a href="{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>


    <script>
      window.onload = () => {
        if(window.load_event){
          for(const key in window.load_event){
            if(key != "load_anime"){
              console.log(key);
              window.load_event[key]();
            }
          }
        }else{
          console.log("没有load事件！");
        }
      };
    </script>
  </body>
</html>

